{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport _classCallCheck from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"E:\\\\project\\\\environment-web\\\\src\\\\pages\\\\bigScreen\\\\History.js\";\nimport React, { Component } from 'react';\nimport moment from 'moment';\nimport ReactEcharts from 'echarts-for-react';\n\nvar History = /*#__PURE__*/function (_Component) {\n  _inherits(History, _Component);\n\n  function History(props) {\n    var _this;\n\n    _classCallCheck(this, History);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(History).call(this, props));\n    _this.ref = null;\n    _this.timer = null;\n\n    _this.getData = function () {\n      React.axios.post('api/opcServer/getOpcServer1Data', [_this.props.data.tag], function (res) {\n        var xAxisData = _this.state.xAxisData,\n            seriesData = _this.state.seriesData;\n\n        if (xAxisData.length === 0) {\n          var times = new Date().getTime();\n\n          for (var i = 0; i < 24; i++) {\n            xAxisData.push(moment(times + i * 1000).format('yyyy-MM-DD HH:mm:ss'));\n          }\n        }\n\n        if (seriesData.length === 24) {\n          xAxisData.shift();\n          seriesData.shift();\n          xAxisData.push(moment().format('yyyy-MM-DD HH:mm:ss'));\n        }\n\n        seriesData.push(res.data[_this.props.data.tag]);\n        var options = _this.state.options;\n        options.xAxis.data = xAxisData;\n        options.series[0].data = seriesData;\n\n        if (_this.ref) {\n          _this.ref.getEchartsInstance().setOption(options);\n        }\n\n        _this.setState({\n          xAxisData: xAxisData,\n          seriesData: seriesData\n        });\n      });\n    };\n\n    _this.state = {\n      xAxisData: [],\n      seriesData: [],\n      options: {\n        tooltip: {\n          trigger: 'axis',\n          axisPointer: {\n            type: 'cross'\n          }\n        },\n        grid: {\n          bottom: 50,\n          top: 30,\n          right: 40,\n          left: 60\n        },\n        xAxis: {\n          type: 'category',\n          boundaryGap: false,\n          data: [],\n          axisLabel: {\n            formatter: function formatter(value) {\n              return \"\".concat(moment(value).format('yyyy-MM-DD'), \"\\n\").concat(moment(value).format('HH:mm:ss'));\n            },\n            fontSize: 10,\n            rotate: 40\n          }\n        },\n        yAxis: {\n          type: 'value',\n          splitNumber: 14,\n          axisLabel: {\n            fontSize: 12\n          }\n        },\n        series: [{\n          name: '1#',\n          data: [],\n          type: 'line',\n          smooth: true\n        }]\n      }\n    };\n    return _this;\n  }\n\n  _createClass(History, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.getData();\n      this.timer = setInterval(function () {\n        _this2.getData();\n      }, 1000);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      clearInterval(this.timer);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return /*#__PURE__*/React.createElement(_Modal, {\n        footer: \"\",\n        title: this.props.data.title,\n        width: \"90%\",\n        visible: true,\n        onCancel: this.props.onCancel,\n        maskClosable: false,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(ReactEcharts, {\n        ref: function ref(e) {\n          _this3.ref = e;\n        },\n        option: this.state.options,\n        style: {\n          height: '400px',\n          width: '100%'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 17\n        }\n      }));\n    }\n  }]);\n\n  return History;\n}(Component);\n\nexport default History;","map":{"version":3,"sources":["E:/project/environment-web/src/pages/bigScreen/History.js"],"names":["React","Component","moment","ReactEcharts","History","props","ref","timer","getData","axios","post","data","tag","res","xAxisData","state","seriesData","length","times","Date","getTime","i","push","format","shift","options","xAxis","series","getEchartsInstance","setOption","setState","tooltip","trigger","axisPointer","type","grid","bottom","top","right","left","boundaryGap","axisLabel","formatter","value","fontSize","rotate","yAxis","splitNumber","name","smooth","setInterval","clearInterval","title","onCancel","e","height","width"],"mappings":";;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AAEA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,YAAP,MAAyB,mBAAzB;;IACMC,O;;;AAGF,mBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,iFAAMA,KAAN;AADe,UAFnBC,GAEmB,GAFb,IAEa;AAAA,UADnBC,KACmB,GADX,IACW;;AAAA,UAuDnBC,OAvDmB,GAuDT,YAAM;AACZR,MAAAA,KAAK,CAACS,KAAN,CAAYC,IAAZ,CAAiB,iCAAjB,EAAoD,CAAC,MAAKL,KAAL,CAAWM,IAAX,CAAgBC,GAAjB,CAApD,EAA0E,UAAAC,GAAG,EAAE;AAC3E,YAAIC,SAAS,GAAG,MAAKC,KAAL,CAAWD,SAA3B;AAAA,YAAsCE,UAAU,GAAG,MAAKD,KAAL,CAAWC,UAA9D;;AACA,YAAIF,SAAS,CAACG,MAAV,KAAmB,CAAvB,EAAyB;AACrB,cAAIC,KAAK,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAZ;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AACzBP,YAAAA,SAAS,CAACQ,IAAV,CAAepB,MAAM,CAACgB,KAAK,GAAGG,CAAC,GAAG,IAAb,CAAN,CAAyBE,MAAzB,CAAgC,qBAAhC,CAAf;AACH;AACJ;;AACD,YAAIP,UAAU,CAACC,MAAX,KAAsB,EAA1B,EAA6B;AACzBH,UAAAA,SAAS,CAACU,KAAV;AACAR,UAAAA,UAAU,CAACQ,KAAX;AACAV,UAAAA,SAAS,CAACQ,IAAV,CAAepB,MAAM,GAAGqB,MAAT,CAAgB,qBAAhB,CAAf;AACH;;AACDP,QAAAA,UAAU,CAACM,IAAX,CAAgBT,GAAG,CAACF,IAAJ,CAAS,MAAKN,KAAL,CAAWM,IAAX,CAAgBC,GAAzB,CAAhB;AACA,YAAIa,OAAO,GAAG,MAAKV,KAAL,CAAWU,OAAzB;AACAA,QAAAA,OAAO,CAACC,KAAR,CAAcf,IAAd,GAAqBG,SAArB;AACAW,QAAAA,OAAO,CAACE,MAAR,CAAe,CAAf,EAAkBhB,IAAlB,GAAyBK,UAAzB;;AACA,YAAI,MAAKV,GAAT,EAAa;AACT,gBAAKA,GAAL,CAASsB,kBAAT,GAA8BC,SAA9B,CAAwCJ,OAAxC;AACH;;AACD,cAAKK,QAAL,CAAc;AACVhB,UAAAA,SAAS,EAAEA,SADD;AAEVE,UAAAA,UAAU,EAAEA;AAFF,SAAd;AAIH,OAxBD;AAyBH,KAjFkB;;AAEf,UAAKD,KAAL,GAAa;AACTD,MAAAA,SAAS,EAAE,EADF;AAETE,MAAAA,UAAU,EAAE,EAFH;AAGTS,MAAAA,OAAO,EAAE;AACLM,QAAAA,OAAO,EAAE;AACLC,UAAAA,OAAO,EAAE,MADJ;AAELC,UAAAA,WAAW,EAAE;AACTC,YAAAA,IAAI,EAAE;AADG;AAFR,SADJ;AAOLC,QAAAA,IAAI,EAAE;AACFC,UAAAA,MAAM,EAAE,EADN;AAEFC,UAAAA,GAAG,EAAE,EAFH;AAGFC,UAAAA,KAAK,EAAE,EAHL;AAIFC,UAAAA,IAAI,EAAE;AAJJ,SAPD;AAaLb,QAAAA,KAAK,EAAE;AACHQ,UAAAA,IAAI,EAAE,UADH;AAEHM,UAAAA,WAAW,EAAE,KAFV;AAGH7B,UAAAA,IAAI,EAAE,EAHH;AAIH8B,UAAAA,SAAS,EAAE;AACPC,YAAAA,SAAS,EAAE,mBAACC,KAAD;AAAA,+BAAczC,MAAM,CAACyC,KAAD,CAAN,CAAcpB,MAAd,CAAqB,YAArB,CAAd,eAAqDrB,MAAM,CAACyC,KAAD,CAAN,CAAcpB,MAAd,CAAqB,UAArB,CAArD;AAAA,aADJ;AAEPqB,YAAAA,QAAQ,EAAE,EAFH;AAGPC,YAAAA,MAAM,EAAE;AAHD;AAJR,SAbF;AAuBLC,QAAAA,KAAK,EAAE;AACHZ,UAAAA,IAAI,EAAE,OADH;AAEHa,UAAAA,WAAW,EAAE,EAFV;AAGHN,UAAAA,SAAS,EAAE;AACPG,YAAAA,QAAQ,EAAE;AADH;AAHR,SAvBF;AA8BLjB,QAAAA,MAAM,EAAE,CACJ;AACIqB,UAAAA,IAAI,EAAE,IADV;AAEIrC,UAAAA,IAAI,EAAE,EAFV;AAGIuB,UAAAA,IAAI,EAAE,MAHV;AAIIe,UAAAA,MAAM,EAAE;AAJZ,SADI;AA9BH;AAHA,KAAb;AAFe;AA6ClB;;;;wCACmB;AAAA;;AAChB,WAAKzC,OAAL;AACA,WAAKD,KAAL,GAAa2C,WAAW,CAAC,YAAI;AACzB,QAAA,MAAI,CAAC1C,OAAL;AACH,OAFuB,EAEtB,IAFsB,CAAxB;AAGH;;;2CACqB;AAClB2C,MAAAA,aAAa,CAAC,KAAK5C,KAAN,CAAb;AACH;;;6BA4BQ;AAAA;;AACL,0BACI;AAAO,QAAA,MAAM,EAAC,EAAd;AAAiB,QAAA,KAAK,EAAE,KAAKF,KAAL,CAAWM,IAAX,CAAgByC,KAAxC;AAA+C,QAAA,KAAK,EAAC,KAArD;AAA2D,QAAA,OAAO,EAAE,IAApE;AAA0E,QAAA,QAAQ,EAAE,KAAK/C,KAAL,CAAWgD,QAA/F;AAAyG,QAAA,YAAY,EAAE,KAAvH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACI,oBAAC,YAAD;AAAc,QAAA,GAAG,EAAE,aAACC,CAAD,EAAO;AAAE,UAAA,MAAI,CAAChD,GAAL,GAAWgD,CAAX;AAAe,SAA3C;AAA6C,QAAA,MAAM,EAAE,KAAKvC,KAAL,CAAWU,OAAhE;AAAyE,QAAA,KAAK,EAAE;AAAE8B,UAAAA,MAAM,EAAE,OAAV;AAAmBC,UAAAA,KAAK,EAAE;AAA1B,SAAhF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CADJ;AAKH;;;;EA3FiBvD,S;;AA8FtB,eAAeG,OAAf","sourcesContent":["import React, { Component } from 'react';\r\nimport { Modal, } from 'antd';\r\nimport moment from 'moment';\r\nimport ReactEcharts from 'echarts-for-react';\r\nclass History extends Component {\r\n    ref = null;\r\n    timer = null;\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            xAxisData: [],\r\n            seriesData: [],\r\n            options: {\r\n                tooltip: {\r\n                    trigger: 'axis',\r\n                    axisPointer: {\r\n                        type: 'cross',\r\n                    }\r\n                },\r\n                grid: {\r\n                    bottom: 50,\r\n                    top: 30,\r\n                    right: 40,\r\n                    left: 60\r\n                },\r\n                xAxis: {\r\n                    type: 'category',\r\n                    boundaryGap: false,\r\n                    data: [],\r\n                    axisLabel: {\r\n                        formatter: (value) => `${moment(value).format('yyyy-MM-DD')}\\n${moment(value).format('HH:mm:ss')}`,\r\n                        fontSize: 10,\r\n                        rotate: 40\r\n                    },\r\n                },\r\n                yAxis: {\r\n                    type: 'value',\r\n                    splitNumber: 14,\r\n                    axisLabel: {\r\n                        fontSize: 12,\r\n                    }\r\n                },\r\n                series: [\r\n                    {\r\n                        name: '1#',\r\n                        data: [],\r\n                        type: 'line',\r\n                        smooth: true\r\n                    }\r\n                ]\r\n            },\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        this.getData();\r\n        this.timer = setInterval(()=>{\r\n            this.getData();\r\n        },1000);\r\n    }\r\n    componentWillUnmount(){\r\n        clearInterval(this.timer);\r\n    }\r\n    getData = () => {\r\n        React.axios.post('api/opcServer/getOpcServer1Data', [this.props.data.tag],res=>{\r\n            let xAxisData = this.state.xAxisData, seriesData = this.state.seriesData;\r\n            if (xAxisData.length===0){\r\n                let times = new Date().getTime();\r\n                for (let i = 0; i < 24; i++) {\r\n                    xAxisData.push(moment(times + i * 1000).format('yyyy-MM-DD HH:mm:ss'));\r\n                }\r\n            }\r\n            if (seriesData.length === 24){\r\n                xAxisData.shift();\r\n                seriesData.shift();\r\n                xAxisData.push(moment().format('yyyy-MM-DD HH:mm:ss'));\r\n            }\r\n            seriesData.push(res.data[this.props.data.tag]);\r\n            let options = this.state.options;\r\n            options.xAxis.data = xAxisData;\r\n            options.series[0].data = seriesData;\r\n            if (this.ref){\r\n                this.ref.getEchartsInstance().setOption(options);\r\n            }\r\n            this.setState({\r\n                xAxisData: xAxisData,\r\n                seriesData: seriesData\r\n            });\r\n        })\r\n    }\r\n    render() {\r\n        return (\r\n            <Modal footer=\"\" title={this.props.data.title} width=\"90%\" visible={true} onCancel={this.props.onCancel} maskClosable={false}>\r\n                <ReactEcharts ref={(e) => { this.ref = e; }} option={this.state.options} style={{ height: '400px', width: '100%' }} />\r\n            </Modal>\r\n        );\r\n    }\r\n}\r\n\r\nexport default History;"]},"metadata":{},"sourceType":"module"}