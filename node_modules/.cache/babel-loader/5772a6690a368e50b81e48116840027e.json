{"ast":null,"code":"import \"antd/es/dropdown/style\";\nimport _Dropdown from \"antd/es/dropdown\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport \"antd/es/tree/style\";\nimport _Tree from \"antd/es/tree\";\nimport \"antd/es/menu/style\";\nimport _Menu from \"antd/es/menu\";\nimport _classCallCheck from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"E:\\\\project\\\\environment-web\\\\src\\\\pages\\\\system\\\\User\\\\List.js\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport React, { Component } from \"react\";\nimport Button from \"@/components/button\";\nimport './List.less';\nimport Table from \"@/components/table\";\nimport Detail from \"./Components/Detail\";\nimport Edit from \"./Components/Edit\";\n\nvar List = /*#__PURE__*/function (_Component) {\n  _inherits(List, _Component);\n\n  function List(props) {\n    var _this;\n\n    _classCallCheck(this, List);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(List).call(this, props));\n    _this.formRef = React.createRef();\n    _this.tableRef = null;\n\n    _this.tableReload = function () {\n      var params = _this.formRef.current.getFieldValue();\n\n      params.deptId = _this.state.deptId;\n\n      _this.tableRef.reload(params);\n    };\n\n    _this.detailOpen = function (detailUserId) {\n      _this.setState({\n        detailVisible: true,\n        detailUserId: detailUserId\n      });\n    };\n\n    _this.detailClose = function () {\n      _this.setState({\n        detailVisible: false,\n        detailUserId: \"\"\n      });\n    };\n\n    _this.editOpen = function (editUserId) {\n      if (editUserId) {\n        _this.setState({\n          editVisible: true,\n          editUserId: editUserId\n        });\n      } else {\n        _this.setState({\n          editVisible: true\n        });\n      }\n\n      ;\n    };\n\n    _this.editClose = function (values) {\n      if (values) {\n        React.axios.post(values.userId ? \"sys/user/update\" : \"sys/user/save\", values, function (res) {\n          _this.setState({\n            editVisible: false,\n            editUserId: \"\"\n          });\n\n          _this.tableReload();\n        });\n      } else {\n        _this.setState({\n          editVisible: false,\n          editUserId: \"\"\n        });\n      }\n\n      ;\n    };\n\n    _this.deleteOpen = function (userId) {\n      React.message.confirm(\"您确定想要删除所选数据？\", function () {\n        React.axios.post(\"/sys/user/delete\", userId, function (res) {\n          _this.tableReload();\n        });\n      });\n    };\n\n    _this.deleteUsers = function () {\n      var selectedRowKeys = _this.state.selectedRowKeys;\n\n      _this.deleteOpen(selectedRowKeys);\n    };\n\n    _this.reset = function () {\n      _this.formRef.current.resetFields();\n\n      _this.tableReload();\n    };\n\n    _this.resetPassword = function (record) {\n      React.message.confirm( /*#__PURE__*/React.createElement(\"div\", {\n        align: \"center\",\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 31\n        }\n      }, \"\\u91CD\\u7F6E\\u540E\\u5BC6\\u7801\\u4E3A\\uFF1A\\u8D26\\u53F7+123456\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: _assertThisInitialized(_assertThisInitialized(_this)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 67\n        }\n      }), \"\\u786E\\u5B9A\\u8981\\u91CD\\u7F6E\\u5417\\uFF1F\"), function () {\n        React.axios.post(\"sys/user/resetPwd\", {\n          userId: record.userId,\n          username: record.username\n        }, function () {\n          React.message.success('密码重置成功！');\n        });\n      });\n    };\n\n    _this.getDeptData = function () {\n      React.axios.get('api/sys/dept/list', null, function (res) {\n        _this.filterTree(res.data);\n\n        _this.setState({\n          deptData: res.data\n        });\n      });\n    };\n\n    _this.filterTree = function (data) {\n      var _iterator = _createForOfIteratorHelper(data),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var item = _step.value;\n          item.key = item.deptId;\n          item.title = item.name;\n\n          if (item.children) {\n            _this.filterTree(item.children);\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      return data;\n    };\n\n    _this.onSelectDept = function (e) {\n      if (e.length > 0) _this.setState({\n        deptId: e[0]\n      }, function () {\n        _this.tableReload();\n      });else _this.setState({\n        deptId: ''\n      }, function () {\n        _this.tableReload();\n      });\n    };\n\n    _this.state = {\n      editVisible: false,\n      editUserId: \"\",\n      detailVisible: false,\n      detailUserId: \"\",\n      selectedRowKeys: [],\n      params: {\n        username: \"\"\n      },\n      deptId: '',\n      deptData: []\n    };\n    return _this;\n  }\n\n  _createClass(List, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getDeptData();\n    }\n    /**\r\n     * @todo 搜索与刷新\r\n     */\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          editVisible = _this$state.editVisible,\n          editUserId = _this$state.editUserId,\n          detailVisible = _this$state.detailVisible,\n          detailUserId = _this$state.detailUserId,\n          selectedRowKeys = _this$state.selectedRowKeys;\n      var tableColumns = [{\n        title: \"用户名\",\n        key: \"username\",\n        dataIndex: \"username\"\n      }, {\n        title: \"真实姓名\",\n        key: \"name\",\n        dataIndex: \"name\"\n      }, {\n        title: \"手机号\",\n        key: \"mobile\",\n        dataIndex: \"mobile\",\n        align: 'center'\n      }, {\n        title: \"状态\",\n        key: \"status\",\n        dataIndex: \"status\",\n        align: 'center',\n        render: function render(text, record) {\n          return React.enums.status[record.status];\n        }\n      }, {\n        title: \"操作\",\n        width: \"300px\",\n        align: 'center',\n        render: function render(text, record) {\n          return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n            type: \"link\",\n            size: \"small\",\n            onClick: _this2.detailOpen.bind(_this2, record.userId),\n            authcode: \"sys:user:info\",\n            icon: \"info\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 177,\n              columnNumber: 21\n            }\n          }, \"\\u8BE6\\u60C5\"), /*#__PURE__*/React.createElement(Button, {\n            type: \"link\",\n            size: \"small\",\n            onClick: _this2.editOpen.bind(_this2, record.userId),\n            authcode: \"sys:user:update\",\n            icon: \"edit\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 178,\n              columnNumber: 21\n            }\n          }, \"\\u4FEE\\u6539\"), /*#__PURE__*/React.createElement(Button, {\n            type: \"link\",\n            size: \"small\",\n            onClick: _this2.resetPassword.bind(_this2, record),\n            authcode: \"sys:user:update\",\n            icon: \"chongzhi\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 21\n            }\n          }, \"\\u91CD\\u7F6E\\u5BC6\\u7801\"), /*#__PURE__*/React.createElement(Button, {\n            type: \"link\",\n            size: \"small\",\n            danger: true,\n            onClick: _this2.deleteOpen.bind(_this2, [record.userId]),\n            authcode: \"sys:user:delete\",\n            icon: \"delete\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 180,\n              columnNumber: 21\n            }\n          }, \"\\u5220\\u9664\"));\n        }\n      }];\n      var menu = /*#__PURE__*/React.createElement(_Menu, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(_Menu.Item, {\n        onClick: this.deleteUsers,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 17\n        }\n      }, \"\\u6279\\u91CF\\u5220\\u9664\"));\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"flex\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"left\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(_Tree, {\n        onSelect: this.onSelectDept,\n        treeData: this.state.deptData,\n        titleRender: function titleRender(e) {\n          return e.name;\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(_Form, {\n        layout: \"inline\",\n        onFinish: this.tableReload,\n        onReset: this.reset,\n        ref: this.formRef,\n        className: \"query-tools\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(_Form.Item, {\n        name: \"username\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(_Input, {\n        placeholder: \"\\u7528\\u6237\\u540D\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 29\n        }\n      })), /*#__PURE__*/React.createElement(_Form.Item, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        type: \"primary\",\n        htmlType: \"submit\",\n        icon: \"search\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 29\n        }\n      }, \"\\u641C\\u7D22\")), /*#__PURE__*/React.createElement(_Form.Item, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        htmlType: \"reset\",\n        icon: \"chongzhi\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 29\n        }\n      }, \"\\u91CD\\u7F6E\")), /*#__PURE__*/React.createElement(_Form.Item, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        type: \"primary\",\n        onClick: this.editOpen.bind(this, \"\"),\n        authcode: \"sys:user:save\",\n        icon: \"add\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 29\n        }\n      }, \"\\u65B0\\u589E\")), selectedRowKeys.length > 0 && /*#__PURE__*/React.createElement(_Form.Item, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(_Dropdown, {\n        overlay: menu,\n        trigger: ['click'],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"iconfont icon-xiala\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 45\n        }\n      }), \"\\u64CD\\u4F5C\")))), /*#__PURE__*/React.createElement(Table, {\n        rowKey: \"userId\",\n        onRef: function onRef(ref) {\n          return _this2.tableRef = ref;\n        },\n        columns: tableColumns,\n        method: \"get\",\n        url: \"sys/user/list\",\n        selectedRowKeys: selectedRowKeys,\n        onSelectKeys: function onSelectKeys(selectedRowKeys) {\n          _this2.setState({\n            selectedRowKeys: selectedRowKeys\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 21\n        }\n      }))), editVisible && /*#__PURE__*/React.createElement(Edit, {\n        userId: editUserId,\n        close: this.editClose,\n        tableReload: this.tableReload,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 33\n        }\n      }), detailVisible && /*#__PURE__*/React.createElement(Detail, {\n        userId: detailUserId,\n        close: this.detailClose,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 35\n        }\n      }));\n    }\n  }]);\n\n  return List;\n}(Component);\n\n;\nexport default List;","map":{"version":3,"sources":["E:/project/environment-web/src/pages/system/User/List.js"],"names":["React","Component","Button","Table","Detail","Edit","List","props","formRef","createRef","tableRef","tableReload","params","current","getFieldValue","deptId","state","reload","detailOpen","detailUserId","setState","detailVisible","detailClose","editOpen","editUserId","editVisible","editClose","values","axios","post","userId","res","deleteOpen","message","confirm","deleteUsers","selectedRowKeys","reset","resetFields","resetPassword","record","username","success","getDeptData","get","filterTree","data","deptData","item","key","title","name","children","onSelectDept","e","length","tableColumns","dataIndex","align","render","text","enums","status","width","bind","menu","ref"],"mappings":"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","sourcesContent":["import React,{Component} from \"react\";\r\nimport {Form, Input, Dropdown, Menu, Tree} from \"antd\";\r\nimport Button from \"@/components/button\";\r\nimport './List.less';\r\nimport Table from \"@/components/table\";\r\n\r\nimport Detail from \"./Components/Detail\";\r\nimport Edit from \"./Components/Edit\";\r\n\r\nclass List extends Component{\r\n    formRef = React.createRef();\r\n    tableRef=null;\r\n    constructor(props){\r\n        super(props);\r\n        this.state= {\r\n            editVisible:false,\r\n            editUserId:\"\",\r\n            detailVisible:false,\r\n            detailUserId:\"\",\r\n            selectedRowKeys:[],\r\n            params:{username:\"\"},\r\n            deptId: '',\r\n            deptData: []\r\n        };\r\n    };\r\n\r\n    componentDidMount(){\r\n        this.getDeptData();\r\n    }\r\n\r\n\r\n    /**\r\n     * @todo 搜索与刷新\r\n     */\r\n    tableReload = () => {\r\n        let params = this.formRef.current.getFieldValue();\r\n        params.deptId = this.state.deptId;\r\n        this.tableRef.reload(params);\r\n    };\r\n\r\n    /**\r\n     * @todo 打开用户详情\r\n     * @param {string} detailUserId \r\n     */\r\n    detailOpen = (detailUserId) => {\r\n        this.setState({detailVisible:true,detailUserId});\r\n    };\r\n\r\n    /**\r\n     * @todo 关闭用户详情\r\n     */\r\n    detailClose = () => {\r\n        this.setState({detailVisible:false,detailUserId:\"\"});\r\n    };\r\n\r\n    /**\r\n     * @todo 打开用户编辑\r\n     * @param {string} editUserId \r\n     */\r\n    editOpen = (editUserId) => {\r\n        if(editUserId){\r\n            this.setState({editVisible:true,editUserId});\r\n        }else{\r\n            this.setState({editVisible:true});\r\n        };\r\n    };\r\n\r\n    /**\r\n     * @todo 关闭用户编辑\r\n     */\r\n    editClose = (values) => {\r\n        if(values){\r\n            React.axios.post(values.userId ? (\"sys/user/update\") : (\"sys/user/save\"),values,res => {\r\n                this.setState({editVisible:false,editUserId:\"\"});\r\n                this.tableReload();\r\n            });\r\n        }else{\r\n            this.setState({editVisible:false,editUserId:\"\"});\r\n        };\r\n    };\r\n\r\n    /**\r\n     * @todo 删除用户\r\n     */\r\n    deleteOpen = (userId) => {\r\n        React.message.confirm(\"您确定想要删除所选数据？\",\r\n            () => {\r\n                React.axios.post(\"/sys/user/delete\",userId,res => {\r\n                    this.tableReload();\r\n                });\r\n            }\r\n        );\r\n    };\r\n\r\n    /**\r\n     * @todo 批量删除用户\r\n     */\r\n    deleteUsers = () => {\r\n        const {selectedRowKeys} = this.state;\r\n        this.deleteOpen(selectedRowKeys);\r\n    };\r\n\r\n    /**\r\n     * @todo 重置搜索\r\n     */\r\n    reset = () => {\r\n        this.formRef.current.resetFields();\r\n        this.tableReload();\r\n    }; \r\n\r\n    /**\r\n     * @todo 重置密码\r\n     */\r\n    resetPassword = (record) => {\r\n        React.message.confirm(<div align=\"center\">重置后密码为：账号+123456<br/>确定要重置吗？</div>,()=>{\r\n            React.axios.post(\"sys/user/resetPwd\",{userId:record.userId,username: record.username},() => {\r\n                React.message.success('密码重置成功！');\r\n            });\r\n        })\r\n    };\r\n    // 获取部门数据\r\n    getDeptData = ()=>{\r\n        React.axios.get('api/sys/dept/list',null,res=>{\r\n            this.filterTree(res.data);\r\n            this.setState({deptData: res.data});\r\n        })\r\n    }\r\n    // 递归树\r\n    filterTree = (data)=>{\r\n        for(let item of data){\r\n            item.key = item.deptId;\r\n            item.title = item.name;\r\n            if(item.children){\r\n                this.filterTree(item.children);\r\n            }\r\n        }\r\n        return data;\r\n    }\r\n    // 选择部门\r\n    onSelectDept = e=>{\r\n        if(e.length>0) this.setState({deptId: e[0]},()=>{this.tableReload();});\r\n        else this.setState({deptId: ''},()=>{this.tableReload();});\r\n    }\r\n\r\n    render(){\r\n        const {editVisible,editUserId,detailVisible,detailUserId,selectedRowKeys} = this.state;\r\n\r\n        const tableColumns = [\r\n            {\r\n                title:\"用户名\",\r\n                key:\"username\",\r\n                dataIndex:\"username\",\r\n            },\r\n            {\r\n                title:\"真实姓名\",\r\n                key:\"name\",\r\n                dataIndex:\"name\",\r\n            },\r\n            {\r\n                title:\"手机号\",\r\n                key:\"mobile\",\r\n                dataIndex:\"mobile\",\r\n                align: 'center',\r\n            },\r\n            {\r\n                title:\"状态\",\r\n                key:\"status\",\r\n                dataIndex:\"status\",\r\n                align: 'center',\r\n                render: (text,record) => React.enums.status[record.status],\r\n            },\r\n            {\r\n                title:\"操作\",\r\n                width:\"300px\",\r\n                align: 'center',\r\n                render:(text,record) => <>\r\n                    <Button type=\"link\" size=\"small\" onClick={this.detailOpen.bind(this,record.userId)} authcode=\"sys:user:info\" icon=\"info\">详情</Button>\r\n                    <Button type=\"link\" size=\"small\" onClick={this.editOpen.bind(this,record.userId)} authcode=\"sys:user:update\" icon=\"edit\">修改</Button>\r\n                    <Button type=\"link\" size=\"small\" onClick={this.resetPassword.bind(this,record)} authcode=\"sys:user:update\" icon=\"chongzhi\">重置密码</Button>\r\n                    <Button type=\"link\" size=\"small\" danger onClick={this.deleteOpen.bind(this,[record.userId])} authcode=\"sys:user:delete\" icon=\"delete\">删除</Button>\r\n                </>\r\n            },\r\n        ];\r\n\r\n        const menu = (\r\n            <Menu>\r\n                <Menu.Item onClick={this.deleteUsers}>批量删除</Menu.Item>\r\n            </Menu>\r\n        );\r\n\r\n        return(\r\n            <>\r\n                <div className=\"flex\">\r\n                    <div className=\"left\">\r\n                        <Tree \r\n                            onSelect={this.onSelectDept}\r\n                            treeData={this.state.deptData}\r\n                            titleRender={e=>e.name}\r\n                        />\r\n                    </div>\r\n                    <div className=\"right\">\r\n                    <Form\r\n                        layout=\"inline\"\r\n                        onFinish={this.tableReload}\r\n                        onReset={this.reset}\r\n                        ref={this.formRef}\r\n                        className=\"query-tools\"\r\n                    >\r\n                        <Form.Item\r\n                            name=\"username\"\r\n                        >\r\n                            <Input placeholder=\"用户名\"/>\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Button type=\"primary\" htmlType=\"submit\" icon=\"search\">搜索</Button>\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Button htmlType=\"reset\" icon=\"chongzhi\">重置</Button>\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Button type=\"primary\" onClick={this.editOpen.bind(this,\"\")} authcode=\"sys:user:save\" icon=\"add\">新增</Button>\r\n                        </Form.Item>\r\n                        {selectedRowKeys.length > 0 && \r\n                            <Form.Item>\r\n                                <Dropdown overlay={menu} trigger={['click']}>\r\n                                    <Button><span className=\"iconfont icon-xiala\"/>操作</Button>\r\n                                </Dropdown>\r\n                            </Form.Item>\r\n                        }\r\n                    </Form>\r\n                    <Table\r\n                        rowKey=\"userId\"\r\n                        onRef={ref=>this.tableRef = ref}\r\n                        columns={tableColumns}\r\n                        method=\"get\"\r\n                        url=\"sys/user/list\"\r\n                        selectedRowKeys={selectedRowKeys}\r\n                        onSelectKeys={(selectedRowKeys) => {\r\n                            this.setState({selectedRowKeys});\r\n                        }}\r\n                    />\r\n                    </div>\r\n                </div>\r\n                \r\n                {editVisible && <Edit userId={editUserId} close={this.editClose} tableReload={this.tableReload}/>}\r\n                {detailVisible && <Detail userId={detailUserId} close={this.detailClose}/>}\r\n            </>\r\n        );\r\n    };\r\n};\r\nexport default List;"]},"metadata":{},"sourceType":"module"}