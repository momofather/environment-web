{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/upload/style\";\nimport _Upload from \"antd/es/upload\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport _classCallCheck from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"E:\\\\project\\\\environment-web\\\\src\\\\pages\\\\system\\\\User\\\\Components\\\\UpdateInfo.js\";\nimport React, { Component } from \"react\";\n\nvar UpdateInfo = /*#__PURE__*/function (_Component) {\n  _inherits(UpdateInfo, _Component);\n\n  function UpdateInfo(props) {\n    var _this;\n\n    _classCallCheck(this, UpdateInfo);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(UpdateInfo).call(this, props));\n    _this.formRef = React.createRef();\n\n    _this.getCurrentUserInfo = function () {\n      React.axios.get('sys/user/info/' + JSON.parse(sessionStorage.getItem('userInfo')).userId, null, function (res) {\n        _this.setState({\n          user: res.data,\n          imageUrl: res.data.heade\n        });\n\n        _this.formRef.current.setFieldsValue(res.data);\n      });\n    };\n\n    _this.submit = function () {\n      _this.formRef.current.validateFields().then(function (values) {\n        var user = _this.state.user;\n        user.heade = _this.state.imageUrl;\n        user.mobile = values.mobile;\n        React.axios.post(\"sys/user/update\", user, function () {\n          React.message.success('修改成功');\n\n          _this.props.onOk();\n        });\n      });\n    };\n\n    _this.beforeUpload = function (file) {\n      var formData = new FormData();\n      formData.append('file', file);\n      React.axios.upload(formData, function (res) {\n        _this.setState({\n          imageUrl: res.url\n        });\n      });\n      return false;\n    };\n\n    _this.state = {\n      user: null,\n      imageUrl: null\n    };\n    return _this;\n  }\n\n  _createClass(UpdateInfo, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getCurrentUserInfo();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(_Modal, {\n        title: \"\\u4FEE\\u6539\\u57FA\\u672C\\u4FE1\\u606F\",\n        visible: true,\n        onOk: this.submit,\n        onCancel: this.props.onCancel,\n        maskClosable: false,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 53,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(_Form, {\n        ref: this.formRef,\n        labelCol: {\n          span: 4\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(_Form.Item, {\n        label: \"\\u7528\\u6237\\u540D\",\n        name: \"username\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(_Input, {\n        disabled: true,\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u7528\\u6237\\u540D\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(_Form.Item, {\n        label: \"\\u771F\\u5B9E\\u59D3\\u540D\",\n        name: \"name\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(_Input, {\n        disabled: true,\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u771F\\u5B9E\\u59D3\\u540D\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(_Form.Item, {\n        label: \"\\u624B\\u673A\\u53F7\\u7801\",\n        name: \"mobile\",\n        rules: [{\n          required: true,\n          message: \"请输入手机号码\"\n        }, {\n          pattern: /^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\\d{8}$/,\n          message: \"手机号码格式不正确\"\n        }],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(_Input, {\n        placeholder: \"\\u624B\\u673A\\u53F7\\u7801\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(_Form.Item, {\n        label: \"\\u5934\\u50CF\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(_Upload, {\n        listType: \"picture-card\",\n        showUploadList: false,\n        action: \"\",\n        beforeUpload: this.beforeUpload,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 25\n        }\n      }, this.state.imageUrl ? /*#__PURE__*/React.createElement(\"img\", {\n        src: this.state.imageUrl,\n        alt: \"avatar\",\n        style: {\n          width: '100%'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 52\n        }\n      }) : '上传头像'))));\n    }\n  }]);\n\n  return UpdateInfo;\n}(Component);\n\n;\nexport default UpdateInfo;","map":{"version":3,"sources":["E:/project/environment-web/src/pages/system/User/Components/UpdateInfo.js"],"names":["React","Component","UpdateInfo","props","formRef","createRef","getCurrentUserInfo","axios","get","JSON","parse","sessionStorage","getItem","userId","res","setState","user","data","imageUrl","heade","current","setFieldsValue","submit","validateFields","then","values","state","mobile","post","message","success","onOk","beforeUpload","file","formData","FormData","append","upload","url","onCancel","span","required","pattern","width"],"mappings":"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","sourcesContent":["import React,{Component} from \"react\";\r\nimport {Modal,Form,Input,Upload} from \"antd\";\r\n\r\nclass UpdateInfo extends Component{\r\n    formRef = React.createRef();\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state={\r\n            user: null,\r\n            imageUrl: null\r\n        };\r\n    };\r\n\r\n    componentDidMount(){\r\n        this.getCurrentUserInfo();\r\n    };\r\n\r\n    // 获取当前用户信息\r\n    getCurrentUserInfo=()=>{\r\n        React.axios.get('sys/user/info/'+JSON.parse(sessionStorage.getItem('userInfo')).userId,null,res=>{\r\n            this.setState({user: res.data,imageUrl: res.data.heade});\r\n            this.formRef.current.setFieldsValue(res.data);\r\n        })\r\n    }\r\n\r\n    /**\r\n     * @todo 提交表单\r\n     */\r\n    submit = () => {\r\n        this.formRef.current.validateFields().then((values) => {\r\n            let user = this.state.user;\r\n            user.heade = this.state.imageUrl;\r\n            user.mobile = values.mobile;\r\n            React.axios.post(\"sys/user/update\",user,() => {\r\n                React.message.success('修改成功');\r\n                this.props.onOk();\r\n            });\r\n        });\r\n    };\r\n\r\n    beforeUpload=(file)=>{\r\n        let formData = new FormData();\r\n        formData.append('file',file);\r\n        React.axios.upload(formData,res=>{\r\n            this.setState({imageUrl: res.url})\r\n        })\r\n        return false;\r\n    }\r\n\r\n    render(){\r\n        return(\r\n            <Modal\r\n                title=\"修改基本信息\"\r\n                visible={true}\r\n                onOk={this.submit}\r\n                onCancel={this.props.onCancel}\r\n                maskClosable={false}\r\n            >\r\n                <Form ref={this.formRef} labelCol={{span: 4}}>\r\n                    <Form.Item\r\n                        label=\"用户名\"\r\n                        name=\"username\"\r\n                    >\r\n                        <Input disabled placeholder=\"请输入用户名\"/>\r\n                    </Form.Item>\r\n                    <Form.Item\r\n                        label=\"真实姓名\"\r\n                        name=\"name\"\r\n                    >\r\n                        <Input disabled placeholder=\"请输入真实姓名\"/>\r\n                    </Form.Item>\r\n                    <Form.Item\r\n                        label=\"手机号码\"\r\n                        name=\"mobile\"\r\n                        rules={[\r\n                            {required:true,message:\"请输入手机号码\"},\r\n                            {pattern:/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\\d{8}$/,message:\"手机号码格式不正确\"}\r\n                        ]}\r\n                    >\r\n                        <Input placeholder=\"手机号码\"/>\r\n                    </Form.Item>\r\n                    <Form.Item label=\"头像\">\r\n                        <Upload\r\n                            listType=\"picture-card\"\r\n                            showUploadList={false}\r\n                            action=\"\"\r\n                            beforeUpload={this.beforeUpload}\r\n                        >\r\n                            {this.state.imageUrl ? <img src={this.state.imageUrl} alt=\"avatar\" style={{ width: '100%' }} /> : '上传头像'}\r\n                        </Upload>\r\n                    </Form.Item>\r\n                </Form>\r\n            </Modal>\r\n        );\r\n    };\r\n};\r\nexport default UpdateInfo;"]},"metadata":{},"sourceType":"module"}