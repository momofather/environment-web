{"ast":null,"code":"import \"antd/es/space/style\";\nimport _Space from \"antd/es/space\";\nimport \"antd/es/dropdown/style\";\nimport _Dropdown from \"antd/es/dropdown\";\nimport \"antd/es/avatar/style\";\nimport _Avatar from \"antd/es/avatar\";\nimport \"antd/es/menu/style\";\nimport _Menu from \"antd/es/menu\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport _toConsumableArray from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport \"antd/es/layout/style\";\nimport _Layout from \"antd/es/layout\";\nvar _jsxFileName = \"E:\\\\project\\\\environment-web\\\\src\\\\components\\\\layout\\\\index.js\";\nimport React, { Component } from 'react';\nimport { withRouter } from \"react-router-dom\";\nimport MenuItem from '../menu'; // import Set from '../set/Index';\n\nimport UpdateUserInfo from '@/pages/system/User/Components/UpdateInfo';\nimport './index.less';\nvar Header = _Layout.Header,\n    Content = _Layout.Content,\n    Sider = _Layout.Sider;\n\nvar Lay_out = /*#__PURE__*/function (_Component) {\n  _inherits(Lay_out, _Component);\n\n  function Lay_out() {\n    var _this;\n\n    _classCallCheck(this, Lay_out);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Lay_out).call(this));\n\n    _this.getCurrentMenus = function () {\n      var _menuList = JSON.parse(sessionStorage.getItem('menus'));\n\n      if (_menuList) {\n        _this.setState({\n          menuList: _menuList\n        });\n\n        if (_menuList.length !== 0) {\n          var leftMenus = [];\n\n          if (!_this.state.currentTopMenu) {\n            _this.setState({\n              currentTopMenu: _menuList[0].menuId\n            }, function () {\n              _menuList.forEach(function (item) {\n                if (item.menuId.toString() === _this.state.currentTopMenu) {\n                  if (item.list) {\n                    leftMenus = _toConsumableArray(item.list);\n                  } else {\n                    leftMenus = [];\n                  }\n\n                  ;\n                }\n\n                ;\n              });\n\n              _this.setState({\n                leftMenus: leftMenus\n              });\n            });\n          } else {\n            _menuList.forEach(function (item) {\n              if (item.menuId.toString() === _this.state.currentTopMenu) {\n                if (item.list) {\n                  leftMenus = _toConsumableArray(item.list);\n                } else {\n                  leftMenus = [];\n                }\n\n                ;\n              }\n\n              ;\n            });\n\n            _this.setState({\n              leftMenus: leftMenus\n            });\n          }\n        }\n      }\n    };\n\n    _this.getCurrentUserInfo = function () {\n      React.axios.get('sys/user/info', null, function (res) {\n        sessionStorage.setItem('userInfo', JSON.stringify(res.data));\n\n        _this.setState({\n          currentUser: res.data\n        });\n      });\n    };\n\n    _this.updateSuccess = function () {\n      _this.getCurrentUserInfo();\n\n      _this.setState({\n        updateUer: false\n      });\n    };\n\n    _this.onCollapse = function (collapsed) {\n      _this.setState({\n        collapsed: collapsed\n      });\n    };\n\n    _this.logout = function () {\n      _this.props.history.replace('/login');\n    };\n\n    _this.linkTo = function (data, i) {\n      if (data.list && data.list.length !== 0) {\n        _this.getFirstMenuPath(data.list[0]);\n      } else {\n        _this.props.history.push(\"/\".concat(React.Version + data.url));\n\n        sessionStorage.setItem('activi_router_path', data.url);\n      }\n\n      sessionStorage.setItem('currentTopMenu', data.menuId);\n\n      _this.setState({\n        leftMenus: data.list,\n        currentTopMenu: data.menuId,\n        showLeftMenus: false\n      });\n\n      setTimeout(function () {\n        _this.setState({\n          showLeftMenus: true\n        });\n      }, 1);\n    };\n\n    _this.getFirstMenuPath = function (data) {\n      if (!data.list || data.list.length === 0) {\n        sessionStorage.setItem('activi_router_path', data.url);\n      } else {\n        _this.getFirstMenuPath(data.list[0]);\n      }\n    };\n\n    _this.changePassword = function () {\n      var formRef = React.createRef();\n\n      _Modal.confirm({\n        title: \"修改密码\",\n        icon: false,\n        content: /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Form, {\n          ref: formRef,\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 21\n          }\n        }, /*#__PURE__*/React.createElement(_Form.Item, {\n          label: \"\\u539F\\u5BC6\\u7801\",\n          name: \"password\",\n          rules: [{\n            required: true,\n            message: \"原密码不能为空\"\n          }],\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 148,\n            columnNumber: 25\n          }\n        }, /*#__PURE__*/React.createElement(_Input.Password, {\n          placeholder: \"\\u539F\\u5BC6\\u7801\",\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 29\n          }\n        })), /*#__PURE__*/React.createElement(_Form.Item, {\n          label: \"\\u65B0\\u5BC6\\u7801\",\n          name: \"newPassword\",\n          rules: [{\n            required: true,\n            message: \"新密码不能为空\"\n          }],\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 25\n          }\n        }, /*#__PURE__*/React.createElement(_Input.Password, {\n          placeholder: \"\\u65B0\\u5BC6\\u7801\",\n          __self: _assertThisInitialized(_assertThisInitialized(_this)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 29\n          }\n        })))),\n        onOk: function onOk() {\n          return new Promise(function (res, rej) {\n            formRef.current.validateFields().then(function (values) {\n              React.axios.post(\"sys/user/password\", values, function (response) {\n                res();\n                React.message.success('修改成功！');\n              }, function (error) {\n                rej();\n              });\n            }).catch();\n          });\n        }\n      });\n    };\n\n    _this.mesageList = function () {\n      _this.props.history.push(\"/\".concat(React.Version, \"/message/index\"));\n    };\n\n    _this.getUnreadCount = function () {\n      React.axios.get(\"msg/tmessage/getStatistics\", null, function (res) {\n        sessionStorage.setItem('unreadCount', res.data);\n        setInterval(function () {\n          var unreadCount = sessionStorage.getItem('unreadCount');\n\n          if (!unreadCount || unreadCount === '0') {\n            unreadCount = 0;\n          }\n\n          _this.setState({\n            unreadCount: unreadCount\n          });\n        }, 60000);\n      });\n    };\n\n    _this.state = {\n      collapsed: false,\n      menuList: [],\n      leftMenus: [],\n      showLeftMenus: true,\n      currentTopMenu: sessionStorage.getItem('currentTopMenu'),\n      theme: 'dark',\n      currentUser: {},\n      unreadCount: 0\n    };\n    return _this;\n  }\n\n  _createClass(Lay_out, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getCurrentMenus();\n      this.getCurrentUserInfo(); // this.getUnreadCount();\n    } // 获取当前用户菜单及权限数据\n\n  }, {\n    key: \"getPath\",\n    value: function getPath(value) {\n      var valueMap = {};\n\n      var loops = function loops(list, parent) {\n        return (list || []).map(function (_ref) {\n          var list = _ref.list,\n              menuId = _ref.menuId;\n          var node = valueMap[menuId] = {\n            parent: parent,\n            value: menuId\n          };\n          node.children = loops(list, node);\n          return node;\n        });\n      };\n\n      var menuList = this.state.menuList;\n      loops(menuList);\n      var path = [];\n      var current = valueMap[value];\n\n      while (current) {\n        path.unshift(current.value);\n        current = current.parent;\n      }\n\n      ;\n      return path;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var flag = false;\n\n      if ((this.state.leftMenus == null || this.state.leftMenus.length === 0) && this.props.location.pathname === '/v1/home') {\n        flag = true;\n      }\n\n      if (!sessionStorage.getItem('token')) {\n        this.props.history.replace('/login');\n      }\n\n      var menu = /*#__PURE__*/React.createElement(_Menu, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(_Menu.Item, {\n        onClick: this.changePassword,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 17\n        }\n      }, \"\\u4FEE\\u6539\\u5BC6\\u7801\"), /*#__PURE__*/React.createElement(_Menu.Item, {\n        onClick: this.logout,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 17\n        }\n      }, \"\\u9000\\u51FA\\u767B\\u5F55\"));\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Layout, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(Header, {\n        className: \"header\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"logo\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 25\n        }\n      }, \"\\u6210\\u90FD\\u4E1C\\u5B89\\u6C34\\u8D28\\u51C0\\u5316\\u5382\\u751F\\u4EA7\\u8FD0\\u884C\\u76D1\\u6D4B\\u5E73\\u53F0\"), /*#__PURE__*/React.createElement(_Menu, {\n        theme: \"dark\",\n        mode: \"horizontal\",\n        className: \"header-middle\",\n        selectedKeys: this.state.currentTopMenu,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 25\n        }\n      }, this.state.menuList.map(function (res, i) {\n        return /*#__PURE__*/React.createElement(_Menu.Item, {\n          key: res.menuId,\n          onClick: _this2.linkTo.bind(_this2, res, i),\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 63\n          }\n        }, res.name);\n      }), /*#__PURE__*/React.createElement(_Menu.Item, {\n        onClick: function onClick() {\n          _this2.props.history.push('/bigscreen');\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 29\n        }\n      }, \"\\u6570\\u636E\\u5927\\u5C4F\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"header-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(_Space, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(_Avatar, {\n        className: \"photo\",\n        icon: /*#__PURE__*/React.createElement(\"img\", {\n          alt: \"\",\n          src: this.state.currentUser.heade || require('../../assets/images/default-photo.png'),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 65\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 33\n        }\n      }), /*#__PURE__*/React.createElement(_Dropdown, {\n        overlay: menu,\n        trigger: ['click'],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"user\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 37\n        }\n      }, this.state.currentUser.name, \"\\xA0\", /*#__PURE__*/React.createElement(React.IconFont, {\n        type: \"icon-xiala\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 95\n        }\n      })))))), /*#__PURE__*/React.createElement(_Layout, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 21\n        }\n      }, this.state.leftMenus && this.state.leftMenus.length !== 0 && /*#__PURE__*/React.createElement(Sider, {\n        className: \"sider\",\n        theme: this.state.theme,\n        width: 200,\n        collapsible: true,\n        collapsed: this.state.collapsed,\n        onCollapse: this.onCollapse,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 83\n        }\n      }, this.state.showLeftMenus && /*#__PURE__*/React.createElement(MenuItem, {\n        theme: this.state.theme,\n        data: this.state.leftMenus,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 56\n        }\n      })), /*#__PURE__*/React.createElement(_Layout, {\n        className: flag ? '' : 'body',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Content, {\n        className: \"content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 29\n        }\n      }, this.props.children)))), this.state.updateUer && /*#__PURE__*/React.createElement(UpdateUserInfo, {\n        onCancel: function onCancel() {\n          _this2.setState({\n            updateUer: false\n          });\n        },\n        onOk: this.updateSuccess,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 40\n        }\n      }));\n    }\n  }]);\n\n  return Lay_out;\n}(Component);\n\nexport default withRouter(Lay_out);","map":{"version":3,"sources":["E:/project/environment-web/src/components/layout/index.js"],"names":["React","Component","withRouter","MenuItem","UpdateUserInfo","Header","Content","Sider","Lay_out","getCurrentMenus","_menuList","JSON","parse","sessionStorage","getItem","setState","menuList","length","leftMenus","state","currentTopMenu","menuId","forEach","item","toString","list","getCurrentUserInfo","axios","get","res","setItem","stringify","data","currentUser","updateSuccess","updateUer","onCollapse","collapsed","logout","props","history","replace","linkTo","i","getFirstMenuPath","push","Version","url","showLeftMenus","setTimeout","changePassword","formRef","createRef","confirm","title","icon","content","required","message","onOk","Promise","rej","current","validateFields","then","values","post","response","success","error","catch","mesageList","getUnreadCount","setInterval","unreadCount","theme","value","valueMap","loops","parent","map","node","children","path","unshift","flag","location","pathname","menu","bind","name","heade","require"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\r\nimport {withRouter} from \"react-router-dom\";\r\nimport { Layout, Menu, Dropdown,Avatar,Modal,Form,Input,Space } from 'antd';\r\nimport MenuItem from '../menu';\r\n// import Set from '../set/Index';\r\nimport UpdateUserInfo from '@/pages/system/User/Components/UpdateInfo';\r\nimport './index.less';\r\n\r\nconst { Header, Content, Sider } = Layout;\r\nclass Lay_out extends Component{\r\n    constructor() {\r\n        super();\r\n        this.state = {\r\n            collapsed: false,\r\n            menuList: [],\r\n            leftMenus: [],\r\n            showLeftMenus: true,\r\n            currentTopMenu: sessionStorage.getItem('currentTopMenu'),\r\n            theme: 'dark',\r\n            currentUser: {},\r\n            unreadCount: 0\r\n        }\r\n    }\r\n    componentDidMount(){\r\n        this.getCurrentMenus();\r\n        this.getCurrentUserInfo();\r\n        // this.getUnreadCount();\r\n    }\r\n    // 获取当前用户菜单及权限数据\r\n    getCurrentMenus=()=>{\r\n        let _menuList = JSON.parse(sessionStorage.getItem('menus'));\r\n        if(_menuList){\r\n            this.setState({menuList: _menuList});\r\n            if(_menuList.length!==0){\r\n                let leftMenus = [];\r\n                if(!this.state.currentTopMenu){\r\n                    this.setState({currentTopMenu: _menuList[0].menuId},()=>{\r\n                        _menuList.forEach((item) => {\r\n                            if(item.menuId.toString() === this.state.currentTopMenu){\r\n                                if(item.list){\r\n                                    leftMenus = [...item.list];\r\n                                }else{\r\n                                    leftMenus = [];\r\n                                };\r\n                            };\r\n                        });\r\n                        this.setState({leftMenus});\r\n                    });\r\n                }else{\r\n                    _menuList.forEach((item) => {\r\n                        if(item.menuId.toString() === this.state.currentTopMenu){\r\n                            if(item.list){\r\n                                leftMenus = [...item.list];\r\n                            }else{\r\n                                leftMenus = [];\r\n                            };\r\n                        };\r\n                    });\r\n                    this.setState({leftMenus});\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // 获取当前用户信息\r\n    getCurrentUserInfo=()=>{\r\n        React.axios.get('sys/user/info',null,res=>{\r\n            sessionStorage.setItem('userInfo', JSON.stringify(res.data))\r\n            this.setState({currentUser: res.data});\r\n        })\r\n    }\r\n    // 修改用户信息成功\r\n    updateSuccess=()=>{\r\n        this.getCurrentUserInfo();\r\n        this.setState({updateUer: false});\r\n    }\r\n    onCollapse = collapsed => {\r\n        this.setState({ collapsed });\r\n    };\r\n    // 退出登录\r\n    logout=()=>{\r\n        this.props.history.replace('/login');\r\n    }\r\n    linkTo=(data,i)=>{\r\n        if (data.list && data.list.length !== 0){\r\n            this.getFirstMenuPath(data.list[0]);\r\n        }else{\r\n            this.props.history.push(`/${React.Version+data.url}`);\r\n            sessionStorage.setItem('activi_router_path', data.url);\r\n        }\r\n        sessionStorage.setItem('currentTopMenu',data.menuId);\r\n        this.setState({\r\n            leftMenus: data.list,\r\n            currentTopMenu: data.menuId,\r\n            showLeftMenus: false\r\n        });\r\n        setTimeout(()=>{\r\n            this.setState({\r\n                showLeftMenus: true\r\n            });\r\n        },1);\r\n    }\r\n    getPath(value) {\r\n        const valueMap = {};\r\n        const loops = (list, parent) => {\r\n            return (list || []).map(({ list, menuId }) => {\r\n                const node = (valueMap[menuId] = {\r\n                    parent,\r\n                    value:menuId\r\n                });\r\n                node.children = loops(list, node);\r\n                return node;\r\n            });\r\n        };\r\n        const {menuList} = this.state;\r\n        loops(menuList);\r\n        const path = [];\r\n        let current = valueMap[value];\r\n        while (current) {\r\n            path.unshift(current.value);\r\n            current = current.parent;\r\n        };\r\n        return path;\r\n    };\r\n\r\n\r\n    // 遍历菜单，获取左边菜单第一个地址\r\n    getFirstMenuPath=(data)=>{\r\n        if(!data.list||data.list.length===0){\r\n            sessionStorage.setItem('activi_router_path',data.url);\r\n        }else{\r\n            this.getFirstMenuPath(data.list[0]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @todo 修改密码\r\n     */\r\n    changePassword = () => {\r\n        const formRef = React.createRef();\r\n        Modal.confirm({\r\n            title:\"修改密码\",\r\n            icon:false,\r\n            content:\r\n                <>\r\n                    <Form\r\n                        ref={formRef}\r\n                    >\r\n                        <Form.Item\r\n                            label=\"原密码\"\r\n                            name=\"password\"\r\n                            rules={[\r\n                                {required:true,message:\"原密码不能为空\"}\r\n                            ]}\r\n                        >\r\n                            <Input.Password placeholder=\"原密码\"/>\r\n                        </Form.Item>\r\n                        <Form.Item\r\n                            label=\"新密码\"\r\n                            name=\"newPassword\"\r\n                            rules={[\r\n                                {required:true,message:\"新密码不能为空\"}\r\n                            ]}\r\n                        >\r\n                            <Input.Password placeholder=\"新密码\"/>\r\n                        </Form.Item>\r\n                    </Form>\r\n                </>,\r\n            onOk:() => {\r\n                return new Promise((res,rej) => {\r\n                    formRef.current.validateFields().then(values => {\r\n                        React.axios.post(\"sys/user/password\",values,response => {\r\n                            res();\r\n                            React.message.success('修改成功！');\r\n                        },error => {\r\n                            rej();\r\n                        });\r\n                    }).catch();\r\n                });\r\n            },\r\n        });\r\n    };\r\n\r\n    // 消息列表\r\n    mesageList=()=>{\r\n        this.props.history.push(`/${React.Version}/message/index`);\r\n    }\r\n    // 未读消息数量\r\n    getUnreadCount=()=>{\r\n        React.axios.get(`msg/tmessage/getStatistics`,null,res=>{\r\n            sessionStorage.setItem('unreadCount',res.data);\r\n            setInterval(()=>{\r\n                let unreadCount = sessionStorage.getItem('unreadCount');\r\n                if(!unreadCount || unreadCount==='0'){\r\n                    unreadCount = 0;\r\n                }\r\n                this.setState({unreadCount: unreadCount});\r\n            },60000)\r\n        })\r\n    }\r\n    \r\n    render() {\r\n        let flag = false;\r\n        if((this.state.leftMenus==null||this.state.leftMenus.length===0)&&this.props.location.pathname==='/v1/home'){\r\n            flag = true;\r\n        }\r\n        if(!sessionStorage.getItem('token')){\r\n            this.props.history.replace('/login');\r\n        }\r\n\r\n        const menu = (\r\n            <Menu>\r\n                <Menu.Item onClick={this.changePassword}>修改密码</Menu.Item>\r\n                {/* <Menu.Item onClick={()=>{this.setState({updateUer: true})}}>个人信息</Menu.Item> */}\r\n                <Menu.Item onClick={this.logout}>退出登录</Menu.Item>\r\n            </Menu>\r\n        );\r\n        return(\r\n            <>\r\n                <Layout>\r\n                    <Header className=\"header\">\r\n                        <div className=\"logo\">成都东安水质净化厂生产运行监测平台</div>\r\n                        <Menu theme=\"dark\" mode=\"horizontal\" className=\"header-middle\" selectedKeys={this.state.currentTopMenu}>\r\n                            {this.state.menuList.map((res,i)=><Menu.Item key={res.menuId} onClick={this.linkTo.bind(this,res,i)}>{res.name}</Menu.Item>)}\r\n                            <Menu.Item onClick={()=>{this.props.history.push('/bigscreen')}}>数据大屏</Menu.Item>\r\n                        </Menu>\r\n                        <div className=\"header-right\">\r\n                            <Space>\r\n                                <Avatar className=\"photo\" icon={<img alt=\"\" src={this.state.currentUser.heade||require('../../assets/images/default-photo.png')} />} />\r\n                                <Dropdown overlay={menu} trigger={['click']}>\r\n                                    <span className=\"user\">{this.state.currentUser.name}&nbsp;<React.IconFont type=\"icon-xiala\"/></span>\r\n                                </Dropdown>\r\n                            </Space>\r\n                        </div>\r\n                    </Header>\r\n                    <Layout>\r\n                        {(this.state.leftMenus&&this.state.leftMenus.length!==0)&&<Sider className=\"sider\" theme={this.state.theme} width={200} collapsible collapsed={this.state.collapsed} onCollapse={this.onCollapse}>\r\n                            {this.state.showLeftMenus&&<MenuItem theme={this.state.theme} data={this.state.leftMenus} />}\r\n                        </Sider>}\r\n                        <Layout className={flag?'':'body'}>\r\n                            <Content className=\"content\">{this.props.children}</Content>\r\n                        </Layout>\r\n                    </Layout>\r\n                </Layout>\r\n                {/* <Set changeNav={(e)=>{this.setState({theme: e})}}/> */}\r\n                {this.state.updateUer&&<UpdateUserInfo onCancel={()=>{this.setState({updateUer: false})}} onOk={this.updateSuccess}/>}\r\n            </>\r\n        );\r\n    }\r\n}\r\nexport default withRouter(Lay_out);"]},"metadata":{},"sourceType":"module"}