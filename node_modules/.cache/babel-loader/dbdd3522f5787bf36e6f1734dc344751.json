{"ast":null,"code":"import \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport _classCallCheck from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"E:\\\\project\\\\environment-web\\\\src\\\\pages\\\\inventory\\\\goodsChecking\\\\List.js\";\nimport React, { Component } from \"react\";\nimport Button from \"@/components/button\";\nimport Table from \"@/components/table\";\nimport Edit from \"./components/Edit\";\nimport Detail from \"./components/Detail\";\nimport XLSX from 'xlsx';\n\nvar List = /*#__PURE__*/function (_Component) {\n  _inherits(List, _Component);\n\n  function List(props) {\n    var _this;\n\n    _classCallCheck(this, List);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(List).call(this, props));\n    _this.tableRef = React.createRef();\n    _this.formRef = React.createRef();\n\n    _this.getUnitList = function () {\n      React.axios.post('api/wmsType/tmaterialtype/queryMaterialTypeList?number=unit', null, function (res) {\n        var obj = {};\n        res.data.forEach(function (item) {\n          obj[item.id] = item.name;\n        });\n\n        _this.setState({\n          units: obj\n        });\n      });\n    };\n\n    _this.tableReload = function () {\n      var params = _this.state.params;\n\n      _this.tableRef.reload(params);\n    };\n\n    _this.submit = function (values) {\n      _this.tableRef.reload(values);\n    };\n\n    _this.reset = function () {\n      _this.formRef.current.resetFields();\n\n      _this.tableRef.reload(_this.formRef.current.getFieldsValue(true));\n    };\n\n    _this.openDetail = function (detailId) {\n      _this.props.history.push(\"/\".concat(React.Version, \"/inventory/goodsChecking/detail/\") + detailId);\n    };\n\n    _this.closeDetail = function () {\n      _this.setState({\n        detailVisible: false,\n        detailUserId: \"\"\n      });\n    };\n\n    _this.toLaunch = function (id) {\n      if (id) _this.props.history.push(\"/\".concat(React.Version, \"/inventory/goodsChecking/launchCheck/\").concat(id));else _this.props.history.push(\"/\".concat(React.Version, \"/inventory/goodsChecking/launchCheck\"));\n    };\n\n    _this.closeEdit = function () {\n      _this.setState({\n        editVisible: false\n      });\n    };\n\n    _this.delete = function (id) {\n      React.message.confirm(\"您确定想要删除此条数据？\", function () {\n        React.axios.post(\"api/wms/twarehousebill/delete\", [id], function (res) {\n          _this.tableRef.reload();\n        });\n      });\n    };\n\n    _this.exportExcel = function (id) {\n      React.axios.get(\"api/wms/twarehousebill/info/\" + id, \"\", function (res) {\n        debugger;\n        var list = res.data.wareinventoryStockEntity;\n\n        var data = _this.forMarData({\n          number: '物料编号',\n          name: '物料编号',\n          price: '单价',\n          address: '存放位置',\n          num: '库存数量',\n          totalMoney: '金额',\n          countNum: '盘点数量'\n        }, list);\n\n        var worksheet = XLSX.utils.aoa_to_sheet(data);\n        var new_workbook = XLSX.utils.book_new();\n        XLSX.utils.book_append_sheet(new_workbook, worksheet, \"人员信息\");\n        XLSX.writeFile(new_workbook, \"盘点.xlsx\");\n      });\n    };\n\n    _this.forMarData = function (res, result) {\n      var data = [];\n      var header = [];\n\n      for (var key in res) {\n        header.push(res[key]);\n      }\n\n      data.push(header);\n\n      for (var i in result) {\n        var source = [];\n\n        for (var _key in res) {\n          if (_key === 'price') {\n            source.push(result[i][_key] + '元/' + _this.state.units[result[i].unit]);\n          } else if (_key === 'address') {\n            source.push(result[i].houseName + '/' + result[i].locationName + '/' + result[i].shelvesName);\n          } else if (_key === 'totalMoney') {\n            source.push(result[i].price * +result[i].num + '元');\n          } else {\n            source.push(result[i][_key]);\n          }\n        }\n\n        data.push(source);\n      }\n\n      return data;\n    };\n\n    _this.state = {\n      editId: \"\",\n      editVisible: false,\n      detailId: \"\",\n      detailVisible: false,\n      params: {\n        name: \"\"\n      },\n      units: {}\n    };\n    return _this;\n  }\n\n  _createClass(List, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getUnitList();\n    } // 获取计量单位\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          editId = _this$state.editId,\n          editVisible = _this$state.editVisible,\n          detailId = _this$state.detailId,\n          detailVisible = _this$state.detailVisible;\n      var tableColumns = [{\n        title: \"单据编号\",\n        key: \"number\",\n        dataIndex: \"number\",\n        align: 'center'\n      }, {\n        title: \"盘点日期\",\n        key: \"housedate\",\n        dataIndex: \"housedate\",\n        align: 'center'\n      }, {\n        title: \"盘点方式\",\n        key: \"houseName\",\n        dataIndex: \"houseName\",\n        align: 'center',\n        render: function render(text, record) {\n          return /*#__PURE__*/React.createElement(React.Fragment, null, React.enums.deliverymodes[record.deliverymode]);\n        }\n      }, {\n        title: \"经手人\",\n        key: \"username\",\n        dataIndex: \"username\",\n        align: 'center'\n      }, {\n        title: \"备注\",\n        key: \"remark\",\n        dataIndex: \"remark\"\n      }, {\n        title: \"操作\",\n        width: \"270px\",\n        align: 'center',\n        render: function render(text, record) {\n          return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n            type: \"link\",\n            size: \"small\",\n            onClick: _this2.toLaunch.bind(_this2, record.id),\n            authcode: \"inventory:inWarehouse:update\",\n            icon: \"edit\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 193,\n              columnNumber: 21\n            }\n          }, \"\\u4FEE\\u6539\"), /*#__PURE__*/React.createElement(Button, {\n            type: \"link\",\n            size: \"small\",\n            onClick: _this2.exportExcel.bind(_this2, record.id),\n            authcode: \"inventory:inWarehouse:info\",\n            icon: \"info\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 194,\n              columnNumber: 21\n            }\n          }, \"\\u5BFC\\u51FA\"), /*#__PURE__*/React.createElement(Button, {\n            type: \"link\",\n            size: \"small\",\n            onClick: _this2.openDetail.bind(_this2, record.id),\n            authcode: \"inventory:inWarehouse:info\",\n            icon: \"info\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 195,\n              columnNumber: 21\n            }\n          }, \"\\u8BE6\\u60C5\"), /*#__PURE__*/React.createElement(Button, {\n            type: \"link\",\n            size: \"small\",\n            danger: true,\n            onClick: _this2.delete.bind(_this2, record.id),\n            authcode: \"inventory:inWarehouse:delete\",\n            icon: \"delete\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 196,\n              columnNumber: 21\n            }\n          }, \"\\u5220\\u9664\"));\n        }\n      }];\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Form, {\n        ref: this.formRef,\n        layout: \"inline\",\n        onFinish: this.submit,\n        onReset: this.reset,\n        className: \"query-tools\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(_Form.Item, {\n        name: \"number\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(_Input, {\n        placeholder: \"\\u5355\\u636E\\u7F16\\u53F7\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(_Form.Item, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        type: \"primary\",\n        htmlType: \"submit\",\n        icon: \"search\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 25\n        }\n      }, \"\\u641C\\u7D22\")), /*#__PURE__*/React.createElement(_Form.Item, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        htmlType: \"reset\",\n        icon: \"chongzhi\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 25\n        }\n      }, \"\\u91CD\\u7F6E\")), /*#__PURE__*/React.createElement(_Form.Item, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        type: \"primary\",\n        onClick: this.toLaunch.bind(this, null),\n        authcode: \"inventory:goodsChecking:save\",\n        icon: \"add\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 25\n        }\n      }, \"\\u65B0\\u589E\"))), /*#__PURE__*/React.createElement(Table, {\n        rowKey: \"id\",\n        onRef: function onRef(ref) {\n          return _this2.tableRef = ref;\n        },\n        columns: tableColumns,\n        method: \"get\",\n        url: \"api/wms/twarehousebill/list?type=4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 17\n        }\n      }), editVisible && /*#__PURE__*/React.createElement(Edit, {\n        id: editId,\n        close: this.closeEdit,\n        tableReload: this.tableReload,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 33\n        }\n      }), detailVisible && /*#__PURE__*/React.createElement(Detail, {\n        id: detailId,\n        close: this.closeDetail,\n        tableReload: this.tableReload,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 35\n        }\n      }));\n    }\n  }]);\n\n  return List;\n}(Component);\n\n;\nexport default List;","map":{"version":3,"sources":["E:/project/environment-web/src/pages/inventory/goodsChecking/List.js"],"names":["React","Component","Button","Table","Edit","Detail","XLSX","List","props","tableRef","createRef","formRef","getUnitList","axios","post","res","obj","data","forEach","item","id","name","setState","units","tableReload","params","state","reload","submit","values","reset","current","resetFields","getFieldsValue","openDetail","detailId","history","push","Version","closeDetail","detailVisible","detailUserId","toLaunch","closeEdit","editVisible","delete","message","confirm","exportExcel","get","list","wareinventoryStockEntity","forMarData","number","price","address","num","totalMoney","countNum","worksheet","utils","aoa_to_sheet","new_workbook","book_new","book_append_sheet","writeFile","result","header","key","i","source","unit","houseName","locationName","shelvesName","editId","tableColumns","title","dataIndex","align","render","text","record","enums","deliverymodes","deliverymode","width","bind","ref"],"mappings":";;;;;;;;;;AAAA,OAAOA,KAAP,IAAcC,SAAd,QAA8B,OAA9B;AAEA,OAAOC,MAAP,MAAmB,qBAAnB;AACA,OAAOC,KAAP,MAAkB,oBAAlB;AAEA,OAAOC,IAAP,MAAiB,mBAAjB;AACA,OAAOC,MAAP,MAAmB,qBAAnB;AACA,OAAOC,IAAP,MAAiB,MAAjB;;IAEMC,I;;;AAIF,gBAAYC,KAAZ,EAAkB;AAAA;;AAAA;;AACd,8EAAMA,KAAN;AADc,UAHlBC,QAGkB,GAHPT,KAAK,CAACU,SAAN,EAGO;AAAA,UAFlBC,OAEkB,GAFRX,KAAK,CAACU,SAAN,EAEQ;;AAAA,UAiBlBE,WAjBkB,GAiBN,YAAI;AACZZ,MAAAA,KAAK,CAACa,KAAN,CAAYC,IAAZ,CAAiB,6DAAjB,EAA+E,IAA/E,EAAoF,UAAAC,GAAG,EAAE;AACrF,YAAIC,GAAG,GAAG,EAAV;AACAD,QAAAA,GAAG,CAACE,IAAJ,CAASC,OAAT,CAAiB,UAAAC,IAAI,EAAE;AACnBH,UAAAA,GAAG,CAACG,IAAI,CAACC,EAAN,CAAH,GAAeD,IAAI,CAACE,IAApB;AACH,SAFD;;AAGA,cAAKC,QAAL,CAAc;AAACC,UAAAA,KAAK,EAAEP;AAAR,SAAd;AACH,OAND;AAOH,KAzBiB;;AAAA,UA8BlBQ,WA9BkB,GA8BJ,YAAM;AAAA,UACTC,MADS,GACC,MAAKC,KADN,CACTD,MADS;;AAEhB,YAAKhB,QAAL,CAAckB,MAAd,CAAqBF,MAArB;AACH,KAjCiB;;AAAA,UAsClBG,MAtCkB,GAsCT,UAACC,MAAD,EAAY;AACjB,YAAKpB,QAAL,CAAckB,MAAd,CAAqBE,MAArB;AACH,KAxCiB;;AAAA,UA8ClBC,KA9CkB,GA8CV,YAAM;AACV,YAAKnB,OAAL,CAAaoB,OAAb,CAAqBC,WAArB;;AACA,YAAKvB,QAAL,CAAckB,MAAd,CAAqB,MAAKhB,OAAL,CAAaoB,OAAb,CAAqBE,cAArB,CAAoC,IAApC,CAArB;AACH,KAjDiB;;AAAA,UAuDlBC,UAvDkB,GAuDL,UAACC,QAAD,EAAc;AACvB,YAAK3B,KAAL,CAAW4B,OAAX,CAAmBC,IAAnB,CAAwB,WAAIrC,KAAK,CAACsC,OAAV,wCAAoDH,QAA5E;AACH,KAzDiB;;AAAA,UA6DlBI,WA7DkB,GA6DJ,YAAM;AAChB,YAAKjB,QAAL,CAAc;AAACkB,QAAAA,aAAa,EAAC,KAAf;AAAqBC,QAAAA,YAAY,EAAC;AAAlC,OAAd;AACH,KA/DiB;;AAAA,UAoElBC,QApEkB,GAoEP,UAACtB,EAAD,EAAQ;AACf,UAAGA,EAAH,EAAM,MAAKZ,KAAL,CAAW4B,OAAX,CAAmBC,IAAnB,YAA4BrC,KAAK,CAACsC,OAAlC,kDAAiFlB,EAAjF,GAAN,KACK,MAAKZ,KAAL,CAAW4B,OAAX,CAAmBC,IAAnB,YAA4BrC,KAAK,CAACsC,OAAlC;AAER,KAxEiB;;AAAA,UA4ElBK,SA5EkB,GA4EN,YAAM;AACd,YAAKrB,QAAL,CAAc;AAACsB,QAAAA,WAAW,EAAC;AAAb,OAAd;AACH,KA9EiB;;AAAA,UAoFlBC,MApFkB,GAoFT,UAACzB,EAAD,EAAQ;AACbpB,MAAAA,KAAK,CAAC8C,OAAN,CAAcC,OAAd,CACI,cADJ,EAEI,YAAM;AACF/C,QAAAA,KAAK,CAACa,KAAN,CAAYC,IAAZ,CAAiB,+BAAjB,EAAiD,CAACM,EAAD,CAAjD,EAAsD,UAAAL,GAAG,EAAI;AACzD,gBAAKN,QAAL,CAAckB,MAAd;AACH,SAFD;AAGH,OANL;AAQH,KA7FiB;;AAAA,UA+FlBqB,WA/FkB,GA+FN,UAAC5B,EAAD,EAAM;AACdpB,MAAAA,KAAK,CAACa,KAAN,CAAYoC,GAAZ,CAAgB,iCAA+B7B,EAA/C,EAAkD,EAAlD,EAAqD,UAAAL,GAAG,EAAI;AACxD;AACA,YAAImC,IAAI,GAAGnC,GAAG,CAACE,IAAJ,CAASkC,wBAApB;;AACA,YAAIlC,IAAI,GAAG,MAAKmC,UAAL,CAAgB;AACvBC,UAAAA,MAAM,EAAE,MADe;AAEvBhC,UAAAA,IAAI,EAAE,MAFiB;AAGvBiC,UAAAA,KAAK,EAAE,IAHgB;AAIvBC,UAAAA,OAAO,EAAE,MAJc;AAKvBC,UAAAA,GAAG,EAAE,MALkB;AAMvBC,UAAAA,UAAU,EAAE,IANW;AAOvBC,UAAAA,QAAQ,EAAE;AAPa,SAAhB,EAQTR,IARS,CAAX;;AASA,YAAIS,SAAS,GAAGrD,IAAI,CAACsD,KAAL,CAAWC,YAAX,CAAwB5C,IAAxB,CAAhB;AACA,YAAI6C,YAAY,GAAGxD,IAAI,CAACsD,KAAL,CAAWG,QAAX,EAAnB;AACAzD,QAAAA,IAAI,CAACsD,KAAL,CAAWI,iBAAX,CAA6BF,YAA7B,EAA2CH,SAA3C,EAAsD,MAAtD;AACArD,QAAAA,IAAI,CAAC2D,SAAL,CAAeH,YAAf,EAA6B,SAA7B;AACH,OAhBD;AAiBH,KAjHiB;;AAAA,UAmHlBV,UAnHkB,GAmHP,UAACrC,GAAD,EAAMmD,MAAN,EAAe;AACtB,UAAIjD,IAAI,GAAG,EAAX;AACA,UAAIkD,MAAM,GAAG,EAAb;;AACA,WAAI,IAAIC,GAAR,IAAerD,GAAf,EAAmB;AACfoD,QAAAA,MAAM,CAAC9B,IAAP,CAAYtB,GAAG,CAACqD,GAAD,CAAf;AACH;;AACDnD,MAAAA,IAAI,CAACoB,IAAL,CAAU8B,MAAV;;AACA,WAAI,IAAIE,CAAR,IAAaH,MAAb,EAAoB;AAChB,YAAII,MAAM,GAAG,EAAb;;AACA,aAAI,IAAIF,IAAR,IAAerD,GAAf,EAAmB;AACf,cAAGqD,IAAG,KAAK,OAAX,EAAmB;AACfE,YAAAA,MAAM,CAACjC,IAAP,CAAY6B,MAAM,CAACG,CAAD,CAAN,CAAUD,IAAV,IAAe,IAAf,GAAoB,MAAK1C,KAAL,CAAWH,KAAX,CAAiB2C,MAAM,CAACG,CAAD,CAAN,CAAUE,IAA3B,CAAhC;AACH,WAFD,MAEM,IAAGH,IAAG,KAAK,SAAX,EAAqB;AACvBE,YAAAA,MAAM,CAACjC,IAAP,CAAY6B,MAAM,CAACG,CAAD,CAAN,CAAUG,SAAV,GAAoB,GAApB,GAAwBN,MAAM,CAACG,CAAD,CAAN,CAAUI,YAAlC,GAA+C,GAA/C,GAAmDP,MAAM,CAACG,CAAD,CAAN,CAAUK,WAAzE;AACH,WAFK,MAEA,IAAGN,IAAG,KAAK,YAAX,EAAwB;AAC1BE,YAAAA,MAAM,CAACjC,IAAP,CAAY6B,MAAM,CAACG,CAAD,CAAN,CAAUf,KAAV,GAAgB,CAACY,MAAM,CAACG,CAAD,CAAN,CAAUb,GAA3B,GAA+B,GAA3C;AACH,WAFK,MAED;AACDc,YAAAA,MAAM,CAACjC,IAAP,CAAY6B,MAAM,CAACG,CAAD,CAAN,CAAUD,IAAV,CAAZ;AACH;AACJ;;AACDnD,QAAAA,IAAI,CAACoB,IAAL,CAAUiC,MAAV;AACH;;AACD,aAAOrD,IAAP;AACH,KA1IiB;;AAEd,UAAKS,KAAL,GAAY;AACRiD,MAAAA,MAAM,EAAC,EADC;AAER/B,MAAAA,WAAW,EAAC,KAFJ;AAGRT,MAAAA,QAAQ,EAAC,EAHD;AAIRK,MAAAA,aAAa,EAAC,KAJN;AAKRf,MAAAA,MAAM,EAAC;AAACJ,QAAAA,IAAI,EAAC;AAAN,OALC;AAMRE,MAAAA,KAAK,EAAE;AANC,KAAZ;AAFc;AAUjB;;;;wCAEkB;AACf,WAAKX,WAAL;AACH,K,CAED;;;;6BA4HQ;AAAA;;AAAA,wBACgD,KAAKc,KADrD;AAAA,UACGiD,MADH,eACGA,MADH;AAAA,UACU/B,WADV,eACUA,WADV;AAAA,UACsBT,QADtB,eACsBA,QADtB;AAAA,UAC+BK,aAD/B,eAC+BA,aAD/B;AAGJ,UAAMoC,YAAY,GAAG,CACjB;AACIC,QAAAA,KAAK,EAAC,MADV;AAEIT,QAAAA,GAAG,EAAC,QAFR;AAGIU,QAAAA,SAAS,EAAC,QAHd;AAIIC,QAAAA,KAAK,EAAE;AAJX,OADiB,EAOjB;AACIF,QAAAA,KAAK,EAAC,MADV;AAEIT,QAAAA,GAAG,EAAC,WAFR;AAGIU,QAAAA,SAAS,EAAC,WAHd;AAIIC,QAAAA,KAAK,EAAE;AAJX,OAPiB,EAajB;AACIF,QAAAA,KAAK,EAAC,MADV;AAEIT,QAAAA,GAAG,EAAC,WAFR;AAGIU,QAAAA,SAAS,EAAC,WAHd;AAIIC,QAAAA,KAAK,EAAE,QAJX;AAKIC,QAAAA,MAAM,EAAC,gBAACC,IAAD,EAAMC,MAAN;AAAA,8BAAiB,0CAAGlF,KAAK,CAACmF,KAAN,CAAYC,aAAZ,CAA0BF,MAAM,CAACG,YAAjC,CAAH,CAAjB;AAAA;AALX,OAbiB,EAoBjB;AACIR,QAAAA,KAAK,EAAC,KADV;AAEIT,QAAAA,GAAG,EAAC,UAFR;AAGIU,QAAAA,SAAS,EAAC,UAHd;AAIIC,QAAAA,KAAK,EAAE;AAJX,OApBiB,EA0BjB;AACIF,QAAAA,KAAK,EAAC,IADV;AAEIT,QAAAA,GAAG,EAAC,QAFR;AAGIU,QAAAA,SAAS,EAAC;AAHd,OA1BiB,EA+BjB;AACID,QAAAA,KAAK,EAAC,IADV;AAEIS,QAAAA,KAAK,EAAC,OAFV;AAGIP,QAAAA,KAAK,EAAE,QAHX;AAIIC,QAAAA,MAAM,EAAC,gBAACC,IAAD,EAAMC,MAAN;AAAA,8BAAiB,uDACpB,oBAAC,MAAD;AAAQ,YAAA,IAAI,EAAC,MAAb;AAAoB,YAAA,IAAI,EAAC,OAAzB;AAAiC,YAAA,OAAO,EAAE,MAAI,CAACxC,QAAL,CAAc6C,IAAd,CAAmB,MAAnB,EAAwBL,MAAM,CAAC9D,EAA/B,CAA1C;AAA8E,YAAA,QAAQ,EAAC,8BAAvF;AAAsH,YAAA,IAAI,EAAC,MAA3H;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BADoB,eAEpB,oBAAC,MAAD;AAAQ,YAAA,IAAI,EAAC,MAAb;AAAoB,YAAA,IAAI,EAAC,OAAzB;AAAiC,YAAA,OAAO,EAAE,MAAI,CAAC4B,WAAL,CAAiBuC,IAAjB,CAAsB,MAAtB,EAA2BL,MAAM,CAAC9D,EAAlC,CAA1C;AAAiF,YAAA,QAAQ,EAAC,4BAA1F;AAAuH,YAAA,IAAI,EAAC,MAA5H;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAFoB,eAGpB,oBAAC,MAAD;AAAQ,YAAA,IAAI,EAAC,MAAb;AAAoB,YAAA,IAAI,EAAC,OAAzB;AAAiC,YAAA,OAAO,EAAE,MAAI,CAACc,UAAL,CAAgBqD,IAAhB,CAAqB,MAArB,EAA0BL,MAAM,CAAC9D,EAAjC,CAA1C;AAAgF,YAAA,QAAQ,EAAC,4BAAzF;AAAsH,YAAA,IAAI,EAAC,MAA3H;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAHoB,eAIpB,oBAAC,MAAD;AAAQ,YAAA,IAAI,EAAC,MAAb;AAAoB,YAAA,IAAI,EAAC,OAAzB;AAAiC,YAAA,MAAM,MAAvC;AAAwC,YAAA,OAAO,EAAE,MAAI,CAACyB,MAAL,CAAY0C,IAAZ,CAAiB,MAAjB,EAAsBL,MAAM,CAAC9D,EAA7B,CAAjD;AAAmF,YAAA,QAAQ,EAAC,8BAA5F;AAA2H,YAAA,IAAI,EAAC,QAAhI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAJoB,CAAjB;AAAA;AAJX,OA/BiB,CAArB;AA4CA,0BACI,uDACI;AACI,QAAA,GAAG,EAAE,KAAKT,OADd;AAEI,QAAA,MAAM,EAAC,QAFX;AAGI,QAAA,QAAQ,EAAE,KAAKiB,MAHnB;AAII,QAAA,OAAO,EAAE,KAAKE,KAJlB;AAKI,QAAA,SAAS,EAAC,aALd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAOI,0BAAM,IAAN;AAAW,QAAA,IAAI,EAAC,QAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACI;AAAO,QAAA,WAAW,EAAC,0BAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CAPJ,eAUI,0BAAM,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACI,oBAAC,MAAD;AAAQ,QAAA,IAAI,EAAC,SAAb;AAAuB,QAAA,QAAQ,EAAC,QAAhC;AAAyC,QAAA,IAAI,EAAC,QAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADJ,CAVJ,eAaI,0BAAM,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACI,oBAAC,MAAD;AAAQ,QAAA,QAAQ,EAAC,OAAjB;AAAyB,QAAA,IAAI,EAAC,UAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADJ,CAbJ,eAgBI,0BAAM,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACI,oBAAC,MAAD;AAAQ,QAAA,IAAI,EAAC,SAAb;AAAuB,QAAA,OAAO,EAAE,KAAKY,QAAL,CAAc6C,IAAd,CAAmB,IAAnB,EAAwB,IAAxB,CAAhC;AAA+D,QAAA,QAAQ,EAAC,8BAAxE;AAAuG,QAAA,IAAI,EAAC,KAA5G;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADJ,CAhBJ,CADJ,eAqBI,oBAAC,KAAD;AACI,QAAA,MAAM,EAAC,IADX;AAEI,QAAA,KAAK,EAAE,eAAAC,GAAG;AAAA,iBAAE,MAAI,CAAC/E,QAAL,GAAgB+E,GAAlB;AAAA,SAFd;AAGI,QAAA,OAAO,EAAEZ,YAHb;AAII,QAAA,MAAM,EAAC,KAJX;AAKI,QAAA,GAAG,EAAC,oCALR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QArBJ,EA4BKhC,WAAW,iBAAI,oBAAC,IAAD;AAAM,QAAA,EAAE,EAAE+B,MAAV;AAAkB,QAAA,KAAK,EAAE,KAAKhC,SAA9B;AAAyC,QAAA,WAAW,EAAE,KAAKnB,WAA3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QA5BpB,EA6BKgB,aAAa,iBAAI,oBAAC,MAAD;AAAQ,QAAA,EAAE,EAAEL,QAAZ;AAAsB,QAAA,KAAK,EAAE,KAAKI,WAAlC;AAA+C,QAAA,WAAW,EAAE,KAAKf,WAAjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QA7BtB,CADJ;AAiCH;;;;EAhOcvB,S;;AAiOlB;AACD,eAAeM,IAAf","sourcesContent":["import React,{Component} from \"react\";\r\nimport {Form,Input} from \"antd\";\r\nimport Button from \"@/components/button\";\r\nimport Table from \"@/components/table\";\r\n\r\nimport Edit from \"./components/Edit\";\r\nimport Detail from \"./components/Detail\";\r\nimport XLSX from 'xlsx';\r\n\r\nclass List extends Component{\r\n    tableRef = React.createRef();\r\n    formRef = React.createRef();\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state= {\r\n            editId:\"\",\r\n            editVisible:false,\r\n            detailId:\"\",\r\n            detailVisible:false,\r\n            params:{name:\"\"},\r\n            units: {}\r\n        };\r\n    };\r\n\r\n    componentDidMount(){\r\n        this.getUnitList();\r\n    }\r\n    \r\n    // 获取计量单位\r\n    getUnitList=()=>{\r\n        React.axios.post('api/wmsType/tmaterialtype/queryMaterialTypeList?number=unit',null,res=>{\r\n            let obj = {};\r\n            res.data.forEach(item=>{\r\n                obj[item.id] = item.name;\r\n            })\r\n            this.setState({units: obj});\r\n        })\r\n    }\r\n\r\n    /**\r\n     * @todo 搜索与刷新\r\n     */\r\n    tableReload = () => {\r\n        const {params} = this.state;\r\n        this.tableRef.reload(params);\r\n    };\r\n\r\n    /**\r\n     * @todo 搜索\r\n     */\r\n    submit = (values) => {\r\n        this.tableRef.reload(values);\r\n    };\r\n\r\n    \r\n    /**\r\n     * @todo 重置搜索\r\n     */\r\n    reset = () => {\r\n        this.formRef.current.resetFields();\r\n        this.tableRef.reload(this.formRef.current.getFieldsValue(true));\r\n    };\r\n\r\n    /**\r\n     * @todo 打开详情\r\n     * @param {string} detailUserId\r\n     */\r\n    openDetail = (detailId) => {\r\n        this.props.history.push(`/${React.Version}/inventory/goodsChecking/detail/`+detailId);\r\n    };\r\n    /**inventory/goodsChecking/detail/:id\r\n     * @todo 关闭详情\r\n     */\r\n    closeDetail = () => {\r\n        this.setState({detailVisible:false,detailUserId:\"\"});\r\n    };\r\n\r\n    /**\r\n     * @todo 打开编辑模态框\r\n     */\r\n    toLaunch = (id) => {\r\n        if(id)this.props.history.push(`/${React.Version}/inventory/goodsChecking/launchCheck/${id}`);\r\n        else this.props.history.push(`/${React.Version}/inventory/goodsChecking/launchCheck`);\r\n        \r\n    };\r\n    /**\r\n     * @todo 关闭编辑模态框\r\n     */\r\n    closeEdit = () => {\r\n        this.setState({editVisible:false});\r\n    };\r\n\r\n    /**\r\n     * @todo 删除\r\n     * @param {string} userId\r\n     */\r\n    delete = (id) => {\r\n        React.message.confirm(\r\n            \"您确定想要删除此条数据？\",\r\n            () => {\r\n                React.axios.post(\"api/wms/twarehousebill/delete\",[id],res => {\r\n                    this.tableRef.reload();\r\n                });\r\n            }\r\n        );\r\n    };\r\n    // 导出\r\n    exportExcel=(id)=>{\r\n        React.axios.get(\"api/wms/twarehousebill/info/\"+id,\"\",res => {\r\n            debugger\r\n            let list = res.data.wareinventoryStockEntity;\r\n            let data = this.forMarData({\r\n                number: '物料编号',\r\n                name: '物料编号',\r\n                price: '单价',\r\n                address: '存放位置',\r\n                num: '库存数量',\r\n                totalMoney: '金额',\r\n                countNum: '盘点数量'\r\n            },list);\r\n            let worksheet = XLSX.utils.aoa_to_sheet(data);\r\n            let new_workbook = XLSX.utils.book_new();\r\n            XLSX.utils.book_append_sheet(new_workbook, worksheet, \"人员信息\");\r\n            XLSX.writeFile(new_workbook, \"盘点.xlsx\"); \r\n        });\r\n    };\r\n    // 处理导出数据\r\n    forMarData=(res, result)=>{\r\n        let data = [];\r\n        let header = [];\r\n        for(let key in res){\r\n            header.push(res[key]);\r\n        }\r\n        data.push(header);\r\n        for(let i in result){\r\n            let source = [];\r\n            for(let key in res){\r\n                if(key === 'price'){\r\n                    source.push(result[i][key]+'元/'+this.state.units[result[i].unit]);\r\n                }else if(key === 'address'){\r\n                    source.push(result[i].houseName+'/'+result[i].locationName+'/'+result[i].shelvesName);\r\n                }else if(key === 'totalMoney'){\r\n                    source.push(result[i].price*+result[i].num+'元');\r\n                }else{\r\n                    source.push(result[i][key]);\r\n                }\r\n            }\r\n            data.push(source);\r\n        }\r\n        return data;\r\n    }\r\n\r\n    render(){\r\n        const {editId,editVisible,detailId,detailVisible} = this.state;\r\n\r\n        const tableColumns = [\r\n            {\r\n                title:\"单据编号\",\r\n                key:\"number\",\r\n                dataIndex:\"number\",\r\n                align: 'center',\r\n            },\r\n            {\r\n                title:\"盘点日期\",\r\n                key:\"housedate\",\r\n                dataIndex:\"housedate\",\r\n                align: 'center',\r\n            },\r\n            {\r\n                title:\"盘点方式\",\r\n                key:\"houseName\",\r\n                dataIndex:\"houseName\",\r\n                align: 'center',\r\n                render:(text,record) => <>{React.enums.deliverymodes[record.deliverymode]}</>\r\n            },\r\n            {\r\n                title:\"经手人\",\r\n                key:\"username\",\r\n                dataIndex:\"username\",\r\n                align: 'center',\r\n            },\r\n            {\r\n                title:\"备注\",\r\n                key:\"remark\",\r\n                dataIndex:\"remark\",\r\n            },\r\n            {\r\n                title:\"操作\",\r\n                width:\"270px\",\r\n                align: 'center',\r\n                render:(text,record) => <>\r\n                    <Button type=\"link\" size=\"small\" onClick={this.toLaunch.bind(this,record.id)} authcode=\"inventory:inWarehouse:update\" icon=\"edit\">修改</Button>\r\n                    <Button type=\"link\" size=\"small\" onClick={this.exportExcel.bind(this,record.id)} authcode=\"inventory:inWarehouse:info\" icon=\"info\">导出</Button>\r\n                    <Button type=\"link\" size=\"small\" onClick={this.openDetail.bind(this,record.id)} authcode=\"inventory:inWarehouse:info\" icon=\"info\">详情</Button>\r\n                    <Button type=\"link\" size=\"small\" danger onClick={this.delete.bind(this,record.id)} authcode=\"inventory:inWarehouse:delete\" icon=\"delete\">删除</Button>\r\n                </>\r\n            },\r\n        ];\r\n\r\n        return(\r\n            <>\r\n                <Form\r\n                    ref={this.formRef}\r\n                    layout=\"inline\"\r\n                    onFinish={this.submit}\r\n                    onReset={this.reset}\r\n                    className=\"query-tools\"\r\n                >\r\n                    <Form.Item name=\"number\">\r\n                        <Input placeholder=\"单据编号\"/>\r\n                    </Form.Item>\r\n                    <Form.Item>\r\n                        <Button type=\"primary\" htmlType=\"submit\" icon=\"search\">搜索</Button>\r\n                    </Form.Item>\r\n                    <Form.Item>\r\n                        <Button htmlType=\"reset\" icon=\"chongzhi\">重置</Button>\r\n                    </Form.Item>\r\n                    <Form.Item>\r\n                        <Button type=\"primary\" onClick={this.toLaunch.bind(this,null)} authcode=\"inventory:goodsChecking:save\" icon=\"add\">新增</Button>\r\n                    </Form.Item>\r\n                </Form>\r\n                <Table\r\n                    rowKey=\"id\"\r\n                    onRef={ref=>this.tableRef = ref}\r\n                    columns={tableColumns}\r\n                    method=\"get\"\r\n                    url=\"api/wms/twarehousebill/list?type=4\"\r\n                />\r\n                {editVisible && <Edit id={editId} close={this.closeEdit} tableReload={this.tableReload}/>}\r\n                {detailVisible && <Detail id={detailId} close={this.closeDetail} tableReload={this.tableReload}/>}\r\n            </>\r\n        );\r\n    };\r\n};\r\nexport default List;"]},"metadata":{},"sourceType":"module"}