{"ast":null,"code":"import \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport axios from \"axios\";\nimport Loading from \"@/components/loding\";\nimport URL from './url';\nimport { createHashHistory } from 'history';\nvar history = createHashHistory();\naxios.defaults.headers['Accept'] = 'application/json';\nvar requestCount = 0; // 请求次数\n\nvar config = {\n  baseURL: URL,\n  timeout: 10 * 6000,\n  // Timeout\n  withCredentials: false\n};\n\nvar _axios = axios.create(config);\n\n_axios.interceptors.request.use(function (config) {\n  if (requestCount === 0) {// Loading.show();\n  }\n\n  requestCount++;\n  config.headers.common['token'] = sessionStorage.getItem('token');\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\n\n_axios.interceptors.response.use(function (response) {\n  requestCount--;\n\n  if (requestCount === 0) {\n    Loading.hide();\n  } // 登录失效\n\n\n  if (response.data.code === 401) {\n    history.replace('/login');\n  } else {\n    return response.data;\n  }\n}, function (error) {\n  requestCount--;\n\n  if (requestCount === 0) {\n    Loading.hide();\n\n    _message.error('服务器异常');\n  }\n\n  return Promise.reject(error);\n});\n\nvar _http = {\n  post: function post(url, params, success, err) {\n    _axios.post(url, params).then(function (res) {\n      if (!res) {\n        return;\n      }\n\n      if (res.code === 0) {\n        if (typeof success === 'function') {\n          success(res);\n        }\n      } else {\n        _message.error(res.msg);\n\n        if (typeof err === 'function') {\n          err(res);\n        }\n      }\n    });\n  },\n  get: function get(url, params, success, err) {\n    _axios.get(url, {\n      params: params\n    }).then(function (res) {\n      if (!res) {\n        return;\n      }\n\n      if (res.code === 0) {\n        if (typeof success === 'function') {\n          success(res);\n        }\n      } else {\n        _message.error(res.msg);\n\n        if (typeof err === 'function') {\n          err(res);\n        }\n      }\n    });\n  },\n  delete: function _delete(url, params, success, err) {\n    _axios.delete(url, {\n      params: params\n    }).then(function (res) {\n      if (!res) {\n        return;\n      }\n\n      if (res.code === 0) {\n        if (typeof success === 'function') {\n          success(res);\n        }\n      } else {\n        _message.error(res.msg);\n\n        if (typeof err === 'function') {\n          err(res);\n        }\n      }\n    });\n  },\n  upload: function upload(formData, success) {\n    _axios.post('oss/upload/uploadImg', formData).then(function (res) {\n      if (!res) {\n        return;\n      }\n\n      if (res.code === 0) {\n        if (typeof success === 'function') {\n          res.url = URL + 'oss/upload/getImg' + res.fileName;\n          success(res);\n        }\n      } else {\n        _message.error(res.msg);\n      }\n    });\n  },\n  download: function download(url) {\n    var link = document.createElement('a');\n    link.style.display = 'none';\n    link.href = url;\n    link.setAttribute('download', new Date().getTime());\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(url);\n  }\n};\nexport default _http;","map":{"version":3,"sources":["E:/project/environment-web/src/utils/axios.js"],"names":["axios","Loading","URL","createHashHistory","history","defaults","headers","requestCount","config","baseURL","timeout","withCredentials","_axios","create","interceptors","request","use","common","sessionStorage","getItem","error","Promise","reject","response","hide","data","code","replace","_http","post","url","params","success","err","then","res","msg","get","delete","upload","formData","fileName","download","link","document","createElement","style","display","href","setAttribute","Date","getTime","body","appendChild","click","removeChild","window","revokeObjectURL"],"mappings":"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","sourcesContent":["import { message } from 'antd';\r\nimport axios from \"axios\";\r\nimport Loading from \"@/components/loding\";\r\nimport URL from './url';\r\nimport {createHashHistory} from 'history';\r\nconst history = createHashHistory();\r\naxios.defaults.headers['Accept'] = 'application/json';\r\nvar requestCount = 0; // 请求次数\r\nlet config = {\r\n  baseURL: URL,\r\n  timeout: 10 * 6000, // Timeout\r\n  withCredentials: false,\r\n};\r\n\r\nconst _axios = axios.create(config);\r\n\r\n_axios.interceptors.request.use(\r\n  function(config) {\r\n    if(requestCount === 0){\r\n      // Loading.show();\r\n    }\r\n    requestCount++;\r\n    config.headers.common['token'] = sessionStorage.getItem('token');\r\n    return config;\r\n  },\r\n  function(error) {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n_axios.interceptors.response.use(\r\n  function(response) {\r\n    requestCount--;\r\n    if(requestCount === 0){\r\n      Loading.hide();\r\n    }\r\n    // 登录失效\r\n    if(response.data.code === 401){\r\n      history.replace('/login');\r\n    }else{\r\n      return response.data;\r\n    }\r\n  },\r\n  error => {\r\n    requestCount--;\r\n    if(requestCount === 0){\r\n      Loading.hide();\r\n      message.error('服务器异常');\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nconst _http = {\r\n  post:(url,params,success,err)=>{\r\n    _axios.post(url,params).then(res=>{\r\n      if(!res){\r\n        return;\r\n      }\r\n      if(res.code === 0){\r\n        if (typeof success === 'function') {\r\n          success(res);\r\n        }\r\n      }else {\r\n        message.error(res.msg);\r\n        if (typeof err === 'function') {\r\n          err(res);\r\n        }\r\n      }\r\n    })\r\n  },\r\n  get: (url, params, success, err)=> {\r\n    _axios.get(url, { params: params}).then(res => {\r\n      if(!res){\r\n        return;\r\n      }\r\n      if (res.code === 0) {\r\n        if (typeof success === 'function') {\r\n          success(res);\r\n        }\r\n      } else {\r\n        message.error(res.msg)\r\n        if (typeof err === 'function') {\r\n          err(res);\r\n        }\r\n      }\r\n    })\r\n  },\r\n\tdelete: (url, params, success, err)=>{\r\n\t\t_axios.delete(url, { params: params}).then(res => {\r\n\t\t\tif(!res){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (res.code === 0) {\r\n\t\t\t\tif (typeof success === 'function') {\r\n\t\t\t\t  success(res);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tmessage.error(res.msg)\r\n\t\t\t\tif (typeof err === 'function') {\r\n\t\t\t\t  err(res);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n  upload: (formData,success)=>{\r\n    _axios.post('oss/upload/uploadImg',formData).then(res=>{\r\n      if(!res){\r\n        return;\r\n      }\r\n      if(res.code === 0){\r\n        if (typeof success === 'function') {\r\n          res.url = URL+'oss/upload/getImg'+res.fileName;\r\n          success(res);\r\n        }\r\n      }else{\r\n        message.error(res.msg);\r\n      }\r\n    })\r\n  },\r\n  download: (url)=>{\r\n    let link = document.createElement('a');\r\n    link.style.display = 'none';\r\n    link.href = url;\r\n    link.setAttribute('download', new Date().getTime());\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    window.URL.revokeObjectURL(url);\r\n  }\r\n}\r\nexport default _http;\r\n"]},"metadata":{},"sourceType":"module"}