{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/tree/style\";\nimport _Tree from \"antd/es/tree\";\nimport _toConsumableArray from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"E:\\\\project\\\\environment-web\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"E:\\\\project\\\\environment-web\\\\src\\\\pages\\\\system\\\\role\\\\AuthSet.js\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport React, { Component } from 'react';\nimport Button from '@/components/button';\n\nvar List = /*#__PURE__*/function (_Component) {\n  _inherits(List, _Component);\n\n  function List(props) {\n    var _this;\n\n    _classCallCheck(this, List);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(List).call(this, props));\n    _this.formRef = React.createRef();\n\n    _this.submit = function () {\n      var params = _this.state.roleObj;\n      params.menuIdList = [].concat(_toConsumableArray(_this.state.menuIdList), _toConsumableArray(_this.state.halfCheckedKeys));\n      React.axios.post('sys/role/update', params, function () {\n        React.message.success(\"操作成功\");\n\n        _this.props.onCancel();\n      });\n    };\n\n    _this.getList = function () {\n      React.axios.get('sys/menu/menuTree', null, function (res) {\n        var menuData = _this.filterData(res.data);\n\n        if (_this.props.roleId) {\n          React.axios.get(\"sys/role/info/\".concat(_this.props.roleId), null, function (res) {\n            res.data.menuIdList.forEach(function (key) {\n              _this.filterParentId(key, menuData);\n            });\n\n            _this.setState({\n              roleObj: res.data,\n              menuData: menuData\n            });\n          });\n        }\n      });\n    };\n\n    _this.filterData = function (data) {\n      var _iterator = _createForOfIteratorHelper(data),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var item = _step.value;\n          item.title = item.name;\n          item.key = item.menuId;\n\n          if (item.children) {\n            _this.filterData(item.children);\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      return data;\n    };\n\n    _this.filterParentId = function (key, data) {\n      key = key.toString();\n\n      if (data) {\n        data.forEach(function (item) {\n          if (item.key === key && !item.children) {\n            var menuIdList = _this.state.menuIdList;\n            menuIdList.push(key);\n\n            _this.setState({\n              menuIdList: menuIdList\n            });\n          } else {\n            _this.filterParentId(key, item.children);\n          }\n        });\n      }\n    };\n\n    _this.onCheck = function (checkedKeys, _ref) {\n      var halfCheckedKeys = _ref.halfCheckedKeys;\n\n      _this.setState({\n        menuIdList: checkedKeys,\n        halfCheckedKeys: halfCheckedKeys,\n        disabled: false\n      });\n    };\n\n    _this.getChildId = function (checkedKeYs, array, checked) {\n      if (array) {\n        var _iterator2 = _createForOfIteratorHelper(array),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var item = _step2.value;\n            var index = checkedKeYs.indexOf(item.menuId); // 父节点如果是选中\n\n            if (checked) {\n              if (index === -1) {\n                checkedKeYs.push(item.menuId);\n              }\n            } else {\n              if (index !== -1) {\n                checkedKeYs.splice(index, 1);\n              }\n            }\n\n            _this.getChildId(checkedKeYs, item.children, checked);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      }\n\n      return checkedKeYs;\n    };\n\n    _this.state = {\n      type: 1,\n      roleObj: null,\n      menuData: [],\n      menuIdList: [],\n      halfCheckedKeys: [],\n      disabled: true\n    };\n    return _this;\n  }\n\n  _createClass(List, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getList();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var footer = /*#__PURE__*/React.createElement(\"div\", {\n        align: \"center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 24\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        onClick: this.props.onCancel,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 13\n        }\n      }, \"\\u53D6\\u6D88\"), /*#__PURE__*/React.createElement(Button, {\n        type: \"primary\",\n        onClick: this.submit,\n        disabled: this.state.disabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }\n      }, \"\\u786E\\u5B9A\"));\n      return /*#__PURE__*/React.createElement(_Modal, {\n        title: \"\\u6743\\u9650\\u914D\\u7F6E\",\n        footer: footer,\n        bodyStyle: {\n          maxHeight: '700px',\n          overflow: 'auto'\n        },\n        visible: true,\n        onCancel: this.props.onCancel,\n        onOk: this.submit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 13\n        }\n      }, this.state.menuData.length !== 0 && /*#__PURE__*/React.createElement(_Tree, {\n        checkable: true,\n        checkedKeys: this.state.menuIdList,\n        onCheck: this.onCheck,\n        treeData: this.state.menuData,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 50\n        }\n      }));\n    }\n  }]);\n\n  return List;\n}(Component);\n\nexport default List;","map":{"version":3,"sources":["E:/project/environment-web/src/pages/system/role/AuthSet.js"],"names":["React","Component","Button","List","props","formRef","createRef","submit","params","state","roleObj","menuIdList","halfCheckedKeys","axios","post","message","success","onCancel","getList","get","res","menuData","filterData","data","roleId","forEach","key","filterParentId","setState","item","title","name","menuId","children","toString","push","onCheck","checkedKeys","disabled","getChildId","checkedKeYs","array","checked","index","indexOf","splice","type","footer","maxHeight","overflow","length"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\r\nimport {Modal,Tree} from 'antd';\r\nimport Button from '@/components/button';\r\nclass List extends Component{\r\n    formRef = React.createRef();\r\n    constructor(props){\r\n        super(props);\r\n        this.state = {\r\n            type: 1,\r\n            roleObj: null,\r\n            menuData: [],\r\n            menuIdList: [],\r\n            halfCheckedKeys: [],\r\n            disabled: true\r\n        }\r\n    }\r\n    componentDidMount(){\r\n        this.getList();\r\n    }\r\n\r\n    submit=()=>{\r\n        let params = this.state.roleObj;\r\n        params.menuIdList = [...this.state.menuIdList,...this.state.halfCheckedKeys];\r\n        React.axios.post('sys/role/update',params,()=>{\r\n            React.message.success(\"操作成功\");\r\n            this.props.onCancel();\r\n        })\r\n    }\r\n    // 获取菜单列表数据\r\n    getList=()=>{\r\n        React.axios.get('sys/menu/menuTree',null,res=>{\r\n            let menuData = this.filterData(res.data);\r\n            if(this.props.roleId){\r\n                React.axios.get(`sys/role/info/${this.props.roleId}`,null,res=>{\r\n                    res.data.menuIdList.forEach(key=>{\r\n                        this.filterParentId(key,menuData);\r\n                    })\r\n                    this.setState({roleObj: res.data,menuData: menuData});\r\n                })\r\n            }\r\n        })\r\n    }\r\n    filterData=(data)=>{\r\n        for(let item of data){\r\n            item.title = item.name;\r\n            item.key = item.menuId;\r\n            if(item.children){\r\n                this.filterData(item.children);\r\n            }\r\n        }\r\n        return data;\r\n    }\r\n    // 过滤掉已选节点的父节点id\r\n    filterParentId = (key,data) => {\r\n        key = key.toString();\r\n        if(data){\r\n            data.forEach(item=>{\r\n                if(item.key===key && !item.children){\r\n                    let menuIdList = this.state.menuIdList;\r\n                    menuIdList.push(key);\r\n                    this.setState({ menuIdList: menuIdList});\r\n                }else{\r\n                    this.filterParentId(key,item.children);\r\n                }\r\n            })\r\n        }\r\n    }\r\n    onCheck=(checkedKeys, {halfCheckedKeys})=>{\r\n        this.setState({\r\n            menuIdList: checkedKeys,\r\n            halfCheckedKeys: halfCheckedKeys,\r\n            disabled: false\r\n        });\r\n    }\r\n    // 获取所选节点的所有子节点id\r\n    getChildId=(checkedKeYs,array,checked)=>{\r\n        if(array){\r\n            for(let item of array){\r\n                let index = checkedKeYs.indexOf(item.menuId);\r\n                // 父节点如果是选中\r\n                if(checked){\r\n                    if(index===-1){\r\n                        checkedKeYs.push(item.menuId);\r\n                    }\r\n                }else{\r\n                    if(index!==-1){\r\n                        checkedKeYs.splice(index,1);\r\n                    }\r\n                }\r\n                this.getChildId(checkedKeYs,item.children,checked);\r\n            }\r\n        }\r\n        return checkedKeYs;\r\n    }\r\n    render(){\r\n        const footer = <div align=\"center\">\r\n            <Button onClick={this.props.onCancel}>取消</Button>\r\n            <Button type=\"primary\" onClick={this.submit} disabled={this.state.disabled}>确定</Button>\r\n        </div>\r\n        return(\r\n            <Modal title='权限配置' footer={footer} bodyStyle={{maxHeight: '700px',overflow: 'auto'}} visible={true} onCancel={this.props.onCancel} onOk={this.submit}>\r\n                {this.state.menuData.length!==0&&<Tree\r\n                    checkable\r\n                    checkedKeys={this.state.menuIdList}\r\n                    onCheck={this.onCheck}\r\n                    treeData={this.state.menuData}\r\n                />}\r\n            </Modal>\r\n        );\r\n    }\r\n}\r\nexport default List"]},"metadata":{},"sourceType":"module"}